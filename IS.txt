from email import message
from enum import unique
from os import startfile, stat, stat_result
from sre_parse import State
from tkinter import *
from sqlite3.dbapi2 import Cursor, Row
from tkinter import Tk
from tkinter import ttk
from tkinter import messagebox
from tkinter.font import BOLD
from tkinter.ttk import Combobox, Style, Treeview
from tkinter import Canvas
from unittest import expectedFailure
from numpy import bitwise_and, e, record
from ttkwidgets.autocomplete import AutocompleteCombobox, autocompletecombobox
from datetime import datetime, date
from tkcalendar import Calendar, DateEntry
from tkinter import filedialog as fd
from functools import partial
from tkinter import ttk as objTTK
from PIL import Image, ImageTk

import win32gui
import sqlite3
import getpass
import pandas as pd
import tkinter
import datetime as dt
import sys
import babel.numbers
import xlwings as xw
import pandas as pd
import tkinter as objTK
import datetime as objDateTime
import numpy as np

def WindowCheck():
    WindowsList = []
    def winEnumHandler( hwnd, ctx):
        if win32gui.IsWindowVisible( hwnd ):
            WindowsList.append(win32gui.GetWindowText( hwnd ))

    win32gui.EnumWindows( winEnumHandler, None )
    return WindowsList

dbpath = r''
#dbpath = r''
Supportdb = r''
icon_im = r''
Otherdb = r''
 
user_name = getpass.getuser().lower()
User_ID = getpass.getuser().lower()
UserID = getpass.getuser().lower()

######## Treeview Sorting #################

class MyTreeview(objTTK.Treeview):
    def heading(self, column, sort_by=None, **kwargs):
        if sort_by and not hasattr(kwargs, 'command'):
            func = getattr(self, f"_sort_by_{sort_by}", None)
            if func:
                kwargs['command'] = partial(func, column, False)
        
        return super().heading(column, **kwargs)
    
    def _sort(self, column, reverse, data_type, callback):
        l = [(self.set(k, column), k) for k in self.get_children('')]
        l.sort(key=lambda t: data_type(t[0]), reverse=reverse)
        for index, (_, k) in enumerate(l):
            self.move(k, '', index)
    
        self.heading(column, command=partial(callback, column, not reverse))
    
    def _sort_by_num(self, column, reverse):
        self._sort(column, reverse, int, self._sort_by_num)
    
    def _sort_by_name(self, column, reverse):
        self._sort(column, reverse, str, self._sort_by_name)
    
    def _sort_by_date(self, column, reverse):
        def _str_to_datetime(string):
            return objDateTime.datetime.strptime(string, "%d-%m-%Y")
            
        self._sort(column, reverse, _str_to_datetime, self._sort_by_date)
                        
            
class TimerRun():
    def __init__(self, label):
        self.label = label
        self.StartTime = datetime.now()

        self.reset_clock()

        global RunningTimer
        RunningTimer = True
        
        self.update_clock()
        
    def reset_clock(self):
        global RunningTimer
        RunningTimer = False
        self.label.config(text="Timer: " + "00:00:00")

    def update_clock(self):
        now = datetime.now()
        diff = str(now - self.StartTime)[0:7]
        self.label.configure(text="Timer: " + diff)
        
        global RunningTimer
        if RunningTimer == True:
            self.label.after(1000, self.update_clock)
        else:
            self.label.config(text="Timer: " + "00:00:00")
                        

def import_data(db,Insert_column,Insert_hd):
    sqlconnect = sqlite3.connect(db)
    sqlcur = sqlconnect.cursor()
    sqlcur.execute(Insert_column,Insert_hd)
    sqlconnect.commit()
    sqlconnect.close()

def Select_data(db,query):
    conn = sqlite3.connect(db)
    c = conn.cursor()
    c.execute(query)
    data = []
    for r in c.fetchall():
        data.append(r[0])
    conn.close()
    return data

def Viewtable_data(db,query,record):
    conn = sqlite3.connect(db)
    cur = conn.cursor()
    cur.execute(query,record)
    data = []
    for r in cur.fetchall():
        data.append(r[0])

    conn.close()
    return data

def View_query(db,query,record):
    conn = sqlite3.connect(db)
    c = conn.cursor()
    c.execute(query,record)
    data = []
    for row in c.fetchall():
        data.append(row)
    conn.close()
    return data

def Update_query(query,record):
    sqlconn = sqlite3.connect(dbpath)
    cc = sqlconn.cursor()
    cc.execute(query,record)
    sqlconn.commit()
    sqlconn.close()

def Delete_qury(query, record):
    sqlconn = sqlite3.connect(dbpath)
    conn = sqlconn.cursor()
    conn.execute(query, record)
    sqlconn.commit()
    sqlconn.close()
    
def AcceptNum(inStr,acttyp):
    if acttyp == '1': #insert
        if not inStr.isdigit():
            return False
    return True

def focusNext(widget):
    widget.tk_focusNext().focus_set()
    return 'break'

def focusPrev(widget):
    widget.tk_focusPrev().focus_set()
    return 'break'

def ClosePage(Window):
    Msgbox = messagebox.askyesnocancel('Logout?','''Are you sure want to Logout for the day?
    
    Yes = Logout for the day!
    No = Just Closing the Application''',icon = 'warning')

    if Msgbox == True:
        query = ("INSERT INTO tblhalt_NonP_Hrs (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, NPHours) Values (?,?,?,?,?,?,?,?,?);")
        record = (datetime.now().strftime('%d-%m-%Y'), 'Logout', '', '', '', UserID, datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.min.strftime('%H:%M:%S'))        
        import_data(dbpath, query, record)

        MyWindow = Window
        try:
            MyWindow.destroy()
        except:
            MyWindow.destroy()

    elif Msgbox == False:

        query = ("INSERT INTO tblhalt_NonP_Hrs (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, NPHours) Values (?,?,?,?,?,?,?,?,?);")
        record = (datetime.now().strftime('%d-%m-%Y'), 'Exit', '', '', '', UserID, datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.min.strftime('%H:%M:%S'))        
        import_data(dbpath, query, record)

        MyWindow = Window
        try:
            MyWindow.destroy()
        except:
            MyWindow.destroy()
    else:
        pass

############################################## Non - Production #############################################

global running, hours, minutes, seconds,NPHours
running = False
hours, minutes, seconds = 0, 0, 0
NPHours = datetime.min


#-------- Clock Timing --------#

def ClockRun(Clockroot):

    ClockRun.stopwatch_label = Label(Clockroot,text='00:00:00', bg="white", font=('Calibri', 12, 'bold'))
    ClockRun.stopwatch_label.place(x=370,y=10)

    def start(stopwatch_label, Initial):
        global running
        if not running:
            update(stopwatch_label)
            running = True

    def update(stopwatch_label):
        global hours, minutes, seconds
        seconds += 1
        if seconds == 60:
            minutes += 1
            seconds = 0
        if minutes == 60:
            hours += 1
            minutes = 0

        hours_string = f'{hours}' if hours > 9 else f'0{hours}'
        minutes_string = f'{minutes}' if minutes > 9 else f'0{minutes}'
        seconds_string = f'{seconds}' if seconds > 9 else f'0{seconds}'

        stopwatch_label.config(text=hours_string + ':' + minutes_string + ':' + seconds_string)

        global update_time
        update_time = stopwatch_label.after(1000, lambda:update(stopwatch_label))

    start(ClockRun.stopwatch_label, 'Yes')

#-------- Non - Proudction pages --------#

def Relogin_check():
    
    NPStartTime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')
    
    record = [user_name]         
    query = ("Select * from TblUser_data where USER_ID =? and User_Access ='Yes';")
    user_access = View_query(Supportdb,query,record)
        
    if len(user_access) <= 0 :
        messagebox.showerror("UserID Validation","You don't have access, Kindly check with your team leader!")
        quit()
    
    #------- Input page--------#
    conn = sqlite3.connect(dbpath)    
    Prod_df = pd.read_sql_query("SELECT * FROM tblInput WHERE UserID= '"+ User_ID +"' and ProcessDate='"+ datetime.now().strftime('%d-%m-%Y') + "' ", conn)
    Prod_Max = Prod_df.groupby(['ProcessDate', 'UserID']).agg(Max_Time = ('EndTime', np.max)).reset_index()
    
    #------- Authorisation page--------#
    Auth_df = pd.read_sql_query("SELECT * FROM tblAuthorisation WHERE UserName= '"+ User_ID +"' and Authdate='"+ datetime.now().strftime('%d-%m-%Y') + "' ", conn)
    Auth_Max = Auth_df.groupby(['Authdate', 'UserName']).agg(Max_Time = ('AuthEndTime', np.max)).reset_index()
    Auth_Max = Auth_Max.rename(columns={'Authdate' : 'ProcessDate', 'UserName' : 'UserID'})
    
    #------- QC page--------#
    QC_df = pd.read_sql_query("SELECT * FROM tblQc_Production WHERE QCUserID= '"+ User_ID +"' and Qcdate='"+ datetime.now().strftime('%d-%m-%Y') + "' ", conn)
    QC_Max = QC_df.groupby(['Qcdate', 'QCUserID']).agg(Max_Time = ('QcEndDate', np.max)).reset_index()
    QC_Max =QC_Max.rename(columns ={'Qcdate' : 'ProcessDate', 'QCUserID' : 'UserID'})    
    Prod_TMax =  Auth_Max.append(Prod_Max)    
    TMax = pd.DataFrame(Prod_TMax.append(QC_Max)).fillna(0)
    #print(TMax)    
    if len(TMax) == 0:        
        Last_Prod = 'None'        
        
        # print(Last_Prod)
    else:
        TMax = TMax['Max_Time'].max()
        Last_Prod = TMax
    
    #print(TMax)
            
    #------- Non-Production--------#
    record = [User_ID]
    query = ("Select max(NPEndTime) FROM tblhalt_NonP_Hrs WHERE NPEntryBY =? And NpDate ='" + datetime.now().strftime('%d-%m-%Y') + "';")        
    Last_NProd = View_query(dbpath,query,record)    
    # #print(Last_NProd[0][0])
    
    #------- Production--------#
    # query = ("Select max(EndTime) FROM tblInput WHERE UserID =? And ProcessDate ='" + datetime.now().strftime('%d-%m-%Y') + "';")        
    # Last_Prod = View_query(dbpath,query,record)        
        
        
    
    login_check = Select_data(dbpath, "Select count(NPBreakItem) from tblhalt_NonP_Hrs where NPEntryBY ='"+ User_ID +"' and NpDate ='" + datetime.now().strftime('%d-%m-%Y') + "' and NPBreakItem ='Login';")
    #print(login_check[0])
    if login_check[0]  > 0:
        
        def avoid():
            MsgAnswer = messagebox.askyesno("Exit Re-Loing", "Are you sure want to close without submitting Re-Login details?")
            if MsgAnswer ==True:
                global hours, minutes, seconds
                hours, minutes, seconds = 0, 0, 0
                global running
                running = False                                
                global Relogin_close
                Relogin_close = 'ReLogin-Close'
                Relogin_ISM.destroy()
                #quit()
                             

        def Transaction_Select(event):
            global CB_S_list
            Label1_Activity.place_forget()
            CB_S_Activity.set('')
            CB_S_Activity.place_forget()

            record =[CB_Activity.get()]
            query = ("SELECT TransactionName FROM tblhald_Transaction WHERE ActivityID = (SELECT ActivityID FROM tblhaltActivity WHERE Activity =(?));")
            CB_S_list = Viewtable_data(dbpath, query, record)
            #print(CB_S_list)


            if CB_Activity.get() =="" or len(CB_S_list) ==0:
                Label1_Activity.place_forget()
                CB_S_Activity.set('')
                CB_S_Activity.place_forget()
                CB_S_list =[]

            else:
                Label1_Activity.place(x=90,y=220)
                CB_S_Activity.set('')
                CB_S_Activity.config(state= 'normal')
                CB_S_Activity.place(x=90,y=245)
                CB_S_Activity.config(completevalues=CB_S_list)
                #CB_S_Activity.bind("<<ComboBOdSelected>>", Transaction_Select)

        def breakactivity_select(event):
            global CB_list
            global CB_S_list
            Label_Acivity.place_forget()
            CB_Activity.set('')
            CB_Activity.place_forget()
            
            Label1_Activity.place_forget()
            CB_S_Activity.set('')
            CB_S_Activity.place_forget()

            record =[Cb_Break.get()]
            query = ("SELECT Activity FROM tblhaltActivity WHERE BreakID = (SELECT BreakID FROM tblhalt WHERE BreakItems =(?));")
            CB_list = Viewtable_data(dbpath, query, record)
            
            if Cb_Break.get() =="" or len(CB_list) ==0:
                Label_Acivity.place_forget()
                CB_Activity.set('')
                CB_Activity.place_forget()
                Label1_Activity.place_forget()
                CB_S_Activity.set('')
                CB_S_Activity.place_forget()
                CB_list = []
                CB_S_list= []

            else:
                Label_Acivity.place(x=90,y=150)
                CB_Activity.set('')
                CB_Activity.config(state= 'normal')
                CB_Activity.place(x=90,y=175)
                CB_Activity.config(completevalues=CB_list)
                CB_Activity.bind("<<ComboboxSelected>>", Transaction_Select)
                CB_Activity.bind("<FocusOut>",Transaction_Select)


        global CB_list
        global CB_S_list
        
        Relogin_ISM= Tk()
        Relogin_ISM.geometry("500x420")
        Relogin_ISM.resizable(0,0)
        Relogin_ISM.title("IS_Maintanance - Reloggin")
        Relogin_ISM.config(bg='White')
        Relogin_ISM.iconbitmap(icon_im)
        #ismaint.protocol('WM_DELETE_WINDOW',lambda:ClosePage(ismaint))

        #ClockRun(Relogin_ISM)
        # Relogin_ISM.grab_set()
        Relogin_ISM.protocol('WM_DELETE_WINDOW',avoid)
        
        Msg_L=Label(Relogin_ISM,text="You have already logged-in for the day!! Select reason to proceed further",wraplength=290,fg="#515056",bg="white",bd=0, font=("Calibri", 12,"bold"))
        Msg_L.place(x=80,y=8)
        
        Prod_label = Label(Relogin_ISM,text="Production Time :",font=('Calibri',9,'bold'),bg='white')
        Prod_label.place(x=230,y=55)
        
        Prod_label_Ent = Label(Relogin_ISM,text="00:00:00",font=('Calibri',10,'bold'),bg='white')
        Prod_label_Ent.place(x=350,y=55)
        Prod_label_Ent.config(text= str(Last_Prod),fg='#00728F' )
        
        NProd_label = Label(Relogin_ISM,text="Non-Production Time :",font=('Calibri',9,'bold'),bg='white')
        NProd_label.place(x=230,y=80)
                
        NProd_label_Ent = Label(Relogin_ISM,text="00:00:00",font=('Calibri',10,'bold'),bg='white')
        NProd_label_Ent.place(x=350,y=80)
        NProd_label_Ent.config(text= str(Last_NProd[0][0]),fg='#00728F' )
        
        L_Reason=Label(Relogin_ISM,text="Reason",font=('Calibri (Body)',10,'bold'),bg='white')
        L_Reason.place(x=90,y=80)
        query=Select_data(dbpath, "select BreakItems from tblhalt;")
        
        break_activity = query
        Break_act_prod = 'Continue Production'
        break_activity += [Break_act_prod]        
        Cb_Break=AutocompleteCombobox(Relogin_ISM,font=('Calibri',11) ,width=38,completevalues=break_activity,state='readonly')
        Cb_Break.place(x=90,y=105)
        Cb_Break.bind("<<ComboboxSelected>>", breakactivity_select)
        Cb_Break.bind("<FocusOut>", breakactivity_select)
        
        Label_Acivity=Label(Relogin_ISM,text="Activity", font=('Calibri (Body)',10,'bold'),bg='white')
        Label_Acivity.place(x=90,y=150)
        CB_list=[]
        CB_Activity=AutocompleteCombobox(Relogin_ISM,font=('Calibri',11), state='disable',width=38,completevalues=CB_list)
        CB_Activity.place(x=90,y=175)


        Label1_Activity=Label(Relogin_ISM,text="Sub Activity",font=('Calibri (Body)',10,'bold'),bg='white')
        Label1_Activity.place(x=90,y=220)
        CB_S_list=[]
        CB_S_Activity=AutocompleteCombobox(Relogin_ISM,font=('Calibri',11),state="disable",width=38,completevalues=CB_S_list)
        CB_S_Activity.place(x=90,y=245)

        L_Comment=Label(Relogin_ISM,text="Comments",font=('Calibri (Body)',10,'bold'),bg='white')
        L_Comment.place(x=90,y=290)

        E_Comment=Text(Relogin_ISM,font=('Calibri',13,'bold'),width=35,height=2,bd=3,highlightthickness=0)
        E_Comment.place(x=90,y=315)
        
            
        def Relogin_Submit():
            global CB_list
            global CB_S_list
            global Relogin_close
            Relogin_close = ''
            NPBreakItem = Cb_Break.get()
            NPActivity = CB_Activity.get()
            NPTransactionName = CB_S_Activity.get()
            NPComments = E_Comment.get(1.0,END).strip()
            NPEntryBY = user_name
                        
            if len(CB_list) > 0 and len(CB_S_list) > 0:
                Condition = NPBreakItem == '' or NPActivity == '' or NPTransactionName == ''
                
            elif len(CB_list) == 0 and len(CB_S_list) > 0:
                Condition = NPBreakItem == '' or NPTransactionName == ''
                
            elif len(CB_list) > 0 and len(CB_S_list) == 0:
                Condition = NPBreakItem == '' or NPActivity == ''
                
            elif len(CB_list) == 0 and len(CB_S_list) == 0:
                Condition = NPBreakItem == ''
                                        
            if Condition:
                messagebox.showerror("Validation","Mandatory fields should not be left blank!")
            else:


                global NPHours
                if Cb_Break.get() != 'Continue Production':
                    NpDate = datetime.now().strftime('%d-%m-%Y')
                    NPEndTime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')
                    
                    if Last_Prod == 'None':
                        #------- Non-Production capture --------#
                        record = [User_ID]
                        query = ("Select max(NPStartTime) FROM tblhalt_NonP_Hrs WHERE NPEntryBY =? And NpDate ='" + datetime.now().strftime('%d-%m-%Y') + "' And NPBreakItem ='Login';")        
                        Login_time = View_query(dbpath,query,record)            
                        NPStartTime = Login_time[0][0]                                        
                                            
                    
                    else:
                        #NPStartTime = str(Last_Prod)    
                        NProd_startime1 = datetime.strptime(str(Last_Prod), '%d-%m-%Y %H:%M:%S')
                        NProd_startime2 = datetime.strptime(str(Last_NProd[0][0]), '%d-%m-%Y %H:%M:%S')
                        
                        print(NProd_startime1, NProd_startime2)
                                                    
                        if NProd_startime1> NProd_startime2:
                            NPStartTime = str(Last_Prod)
                        else:
                            NPStartTime = str(Last_NProd[0][0])
                                                                                                    
                    NPHours = NPHours + (datetime.strptime(NPEndTime, '%d-%m-%Y %H:%M:%S') - datetime.strptime(NPStartTime, '%d-%m-%Y %H:%M:%S'))                
                    NP_hrs = datetime.strptime(NPEndTime, '%d-%m-%Y %H:%M:%S') - datetime.strptime(NPStartTime, '%d-%m-%Y %H:%M:%S')                
                    NP_hrs = str(NP_hrs)
                    query = ("INSERT INTO tblhalt_NonP_Hrs (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, NPHours) Values (?,?,?,?,?,?,?,?,?);")
                    record = (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, str(0)+NP_hrs)
                    import_data(dbpath,query,record)
                    NPHours = ''
                    Relogin_ISM.destroy() 
                    
                elif Cb_Break.get()  == 'Continue Production':
                    NPHours = ''
                    Relogin_ISM.destroy() 
    
        
        BT_Mainwin=Button(Relogin_ISM,text='Submit',command=Relogin_Submit,bg="#00728F",fg='white',font=("Calibri",10,'bold'),borderwidth=3, width=10)
        BT_Mainwin.place(x=185,y=380)
        Relogin_ISM.mainloop()
        
    else:
        global Relogin_close
        Relogin_close = ''

######################################################################### End of Non Production ########################################

############################## IS_Maintenance Home page & Username updated ##############################

def Main_Function():              
    
    Relogin_check()
    
    ismaint = Tk()
    ismaint.geometry("1200x600")
    ismaint.resizable(False,False)

    ismaint.title("IS_Maintaince_V2.8")
    ismaint.config(bg="#00728F")
    ismaint.iconbitmap(icon_im)
    ismaint.protocol('WM_DELETE_WINDOW',lambda:ClosePage(ismaint))
    
    # -------- Relogin_check & Close  --------# 
    if Relogin_close == 'ReLogin-Close' :                        
        quit()
    else:
        pass
    
    def Login():

        global active_page
        global But1, But2, But4, But6, But7
        active_page = False    

        stframe = Frame(ismaint,bg="white",width=850,height=550, borderwidth=0,highlightcolor="white", highlightthickness=1,highlightbackground="#faffff")
        stframe.pack(fill=BOTH, padx=10,pady=10,expand=True)
        stframe.propagate(False)  
            
        record = [user_name]         
        query = ("Select * from TblUser_data where USER_ID =? and User_Access ='Yes';")
        user_access = View_query(Supportdb,query,record)
            
        if len(user_access) <= 0 :
            messagebox.showerror("UserID Validation","You don't have access, Kindly check with your team leader!")
            quit()
                    
        else:
            # record = [user_name]    
            login_status = Select_data(dbpath, "Select count(NPBreakItem) from tblhalt_NonP_Hrs where NPEntryBY ='"+ User_ID +"' and NpDate ='" + datetime.now().strftime('%d-%m-%Y') + "' and NPBreakItem ='Login';")
            # Relogin_stattime = Select_data(dbpath, "Select max(NPEndTime) From tblhalt_NonP_Hrs Where NPEntryBY = '"+ User_ID +"' and NpDate ='" + datetime.now().strftime('%d-%m-%Y') + "' and NPBreakItem ='Entry';" )
            # Relogin_endtime = Select_data(dbpath, "Select max(NPEndTime) From tblhalt_NonP_Hrs Where NPEntryBY = '"+ User_ID +"' and NpDate ='" + datetime.now().strftime('%d-%m-%Y') + "' and NPBreakItem ='Exit';" )
            # print(Relogin_endtime)
            # print(Relogin_stattime)
            
            # if Relogin_stattime < Relogin_endtime:
            #     print('Match')
            # else:
            #     print('Not Match')
                
            if login_status[0] == 0:
                query = ("INSERT INTO tblhalt_NonP_Hrs (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, NPHours) Values (?,?,?,?,?,?,?,?,?);")
                record = (datetime.now().strftime('%d-%m-%Y'), 'Login', '', '', '', UserID, datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.min.strftime('%H:%M:%S'))        
                import_data(dbpath, query, record)
            #else:
                                                                      
                # query = ("INSERT INTO tblhalt_NonP_Hrs (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, NPHours) Values (?,?,?,?,?,?,?,?,?);")
                # record = (datetime.now().strftime('%d-%m-%Y'), 'Entry', '', '', '', UserID, datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.now().strftime('%d-%m-%Y %H:%M:%S'), datetime.min.strftime('%H:%M:%S'))        
                # import_data(dbpath, query, record)
                
        for rw in user_access:
            emp_name = rw[1]
            
        ent_uname = Label(stframe, text="Welcome "+ emp_name,bg="white",fg='#0069B2',font=("Calibri (Body)",12,"bold"),width=35)
        ent_uname.place(relx=0.01,rely=0.03)            
        
        But1 = Button(stframe,text="Work Queue",command=lambda:Work_Queue_Check(stframe), width=13,height=1,bg="#00728F",foreground="white", font=("Calibri (Body)", 10,"bold"),borderwidth=3)
        But1.place(relx=0.35,rely=0.02)

        But2 = Button(stframe,text="Input Page", command=lambda:Inputpage_check(stframe), width=13,height=1,bg="#00728F",foreground="white", font=("Calibri (Body)", 10,"bold"),borderwidth=3)
        But2.place(relx=0.47,rely=0.02)

        But4 = Button(stframe,text="Quality", command=lambda:Qualitypage_check(stframe), width=13,height=1,bg="#00728F",foreground="white", font=("Calibri (Body)", 10,"bold"),borderwidth=3)
        But4.place(relx=0.59,rely=0.02)
        
        But6 = Button(stframe,text="Non Production",width=13,height=1,bg="#00728F",foreground="white", font=("Calibri (Body)", 10,"bold"),borderwidth=3,command=Non_Production_hrs)
        But6.place(relx=0.71,rely=0.02)

        But7 = Button(stframe,text="DashBoard",width=13,height=1,bg="#00728F",foreground="white", font=("Calibri (Body)", 10,"bold"),borderwidth=3, command=dashboardPage)
        But7.place(relx=0.83,rely=0.02)       
                
        # But8 = Button(stframe,text="Admin",width=13,height=1,bg="#00728F",foreground="white", font=("Calibri (Body)", 10,"bold"),borderwidth=3, command= Prodcheck)
        # But8.place(relx=0.90,rely=0.02)        

        edframe=Frame(stframe,bg="white",width=5,height=2,relief="solid", borderwidth=0,highlightcolor="#00728F", highlightthickness=2,highlightbackground="#41729c")
        edframe.place(relx=0.000,rely=0.10,width=1199)
        
        Work_Queue_Check(stframe)

    #############################  Work Queue details update from source table #############################

    def Work_Queue_Check(stframe): 
        global active_page       
        if active_page == True:                    
            output = messagebox.askquestion("Active Page Validation", 'Are you sure you want to exit without submitting?')
            if output == "yes":
                active_page = False
                Work_Queue(stframe)
        else:
            Work_Queue(stframe)

    def Work_Queue(stframe):

        But1.config(bg ='sky blue')
        But2.config(background ='#00728F')
        But4.config(background ='#00728F')
        But6.config(background ='#00728F')
        But7.config(background ='#00728F')
        
        
        can_dash = Canvas(stframe,bg="white", height=515,width=1178,highlightthickness=0)
        can_dash.place(relx=0.00,rely=0.11)        

        Label1 = Label(can_dash, text="INPUT",width=15,height=1,fg="black", bg="white",font=("Calibri",13,"bold"))
        Label1.place(relx=0.150,rely=0.02)
        Label2 = Label(can_dash, text="AUTHORISATION",width=15,height=1,fg="black", bg="white",font=("Calibri",13,"bold"))
        Label2.place(relx=0.690,rely=0.02)    

        sty = ttk.Style()
        sty.theme_use('classic')
        sty.configure("Treeview",background="white",foreground='black' ,fieldbackground='white')
        sty.configure('Treeview.Heading',background='#edf0f5',foreground='Black', font=("Calibri", 10, "bold"))
        tree1_header = ["ProcessDate","UserID","CaseReference","Transaction","AccountNo","Authorisation","ProcessStatus","c8","c9","c10" ]
        is_tree1 = MyTreeview(can_dash,columns=tree1_header, show='headings',height=22,)
        is_tree1.column("#1",anchor=CENTER,width=70)
        is_tree1.heading("#1",text="ProcessDate")
        is_tree1.column("#2",anchor=CENTER,width=75)
        is_tree1.heading("#2",text="UserID")
        is_tree1.column("#3",anchor=CENTER,width=80)
        is_tree1.heading("#3",text="CaseReference")
        is_tree1.column('#4',anchor=CENTER,width=90)
        is_tree1.heading('#4',text="Transaction")
        is_tree1.column('#5',anchor=CENTER,width=90)
        is_tree1.heading('#5',text="AccountNo")
        is_tree1.column('#6',anchor=CENTER,width=80)
        is_tree1.heading('#6',text="Authorisation")
        is_tree1.column('#7', anchor=CENTER,width=80)
        is_tree1.heading('#7',text="ProcessStatus")
        is_tree1.column('#8',minwidth=0, width=0)
        #is_tree1.heading('#8',text="Status")
        is_tree1.column('#9', minwidth=0, width=0)
        is_tree1.column('#10', minwidth=0, width=0)  
        
        # -------- Treeview1 sort  --------# 
        tree1sort = ["date","name","name","name","name","name","name","name","name","name"]
        for iCount in range(len(tree1_header)):
            strHdr = tree1_header[iCount]
            is_tree1.heading(strHdr, text=strHdr.title(), sort_by=tree1sort[iCount])
            is_tree1.column(tree1_header[iCount], stretch=True)
                
        is_tree1.place(relx=0.009,rely=0.085)

        tree2_header = ["ProcessDate","InputUserID","CaseReference","Transaction","AccountNo","AuthoriserID","Status","c8","c9","c10" ]
        is_tree2 = MyTreeview(can_dash, columns=tree2_header, show='headings',height=22,)
        is_tree2.column("#1",anchor=CENTER,width=70)
        is_tree2.heading("#1",text="ProcessDate")
        is_tree2.column("#2",anchor=CENTER,width=75)
        is_tree2.heading("#2",text="InputUserID")
        is_tree2.column("#3",anchor=CENTER,width=80)
        is_tree2.heading("#3",text="CaseReference")
        is_tree2.column('#4',anchor=CENTER,width=80)
        is_tree2.heading('#4',text="Transaction")
        is_tree2.column('#5',anchor=CENTER,width=80)
        is_tree2.heading('#5',text="AccountNo")
        is_tree2.column('#6',anchor=CENTER,width=75)
        is_tree2.heading('#6',text="AuthoriserID")
        is_tree2.column('#7', anchor=CENTER,width=90)
        is_tree2.heading('#7',text="Status")
        is_tree2.column('#8',minwidth=0, width=0)
        #is_tree2.heading('#8',text="Status")            
        is_tree2.column('#9', minwidth=0, width=0)
        is_tree2.column('#10', minwidth=0, width=0)
        
        #-------- Treeview2 sort  --------# 
        tree2sort = ["date","name","name","name","name","name","name","name","name","name"]
        for iCount in range(len(tree2_header)):
            strHdr = tree2_header[iCount]
            is_tree2.heading(strHdr, text=strHdr.title(), sort_by=tree2sort[iCount])
            is_tree2.column(tree2_header[iCount], stretch=True)
        
                
        is_tree2.place(relx=0.509,rely=0.085)
        
        scrol_input= Scrollbar(can_dash,orient="vertical",command=is_tree1.yview)
        scrol_input.place(relx=0.488,rely=0.085,height=460)
        is_tree1.configure(yscrollcommand= scrol_input.set)

        scrol_auth = Scrollbar(can_dash,orient= "vertical",command=is_tree2.yview)
        scrol_auth.place(relx=0.975,rely=0.085,height=460)
        is_tree2.configure(yscrollcommand=scrol_auth.set)
        
        def Selected_tree1(event):
            try:
                for item in is_tree1.selection():
                    item_select1 = is_tree1.item(item)
                    UniqueID = item_select1['values'][9]
                    
                Input_Page(stframe, Sourcename = "Input", UniqueID=UniqueID)
            except:
                #messagebox.showerror("alter","Please select the data")
                pass

        def Selected_tree2(event):
            try:
                for item in is_tree2.selection():
                    item_select2 = is_tree2.item(item)         
                    InputuserID = item_select2['values'][1]   
                    Authorisation = item_select2['values'][5]            
                    status = item_select2['values'][7]
                    UniqueID = item_select2['values'][9]                   
                    
                # -------- Main Table username and process status validation  --------#                
                
                record = [UniqueID]   
                query = ("""Select * FROM tblMain WHERE UniqueID = ?;""")        
                Maintable_list = View_query(dbpath,query,record)
                AuthoriserID = Maintable_list[0][2]
                #AuthoriserID = getpass.getuser().lower()                                  
                
                if User_ID == InputuserID:
                    messagebox.showwarning("Alert", "You cannot authorise a job which you have created.")
                    return False      
                
                elif User_ID != AuthoriserID and AuthoriserID !='':
                    record = [AuthoriserID]  
                    query = ("Select NAME from TblUser_data where USER_ID = ?")
                    UserName = Viewtable_data(Supportdb,query,record) 
                    messagebox.showwarning("Oops", "This job is currently being worked by " +  UserName[0])
                    Work_Queue(stframe) 
                    return False              
                
                elif AuthoriserID == '':
                    # -------- Authorise acces check with support table  --------# 
                    record = [User_ID]
                    query = ("""Select * FROM TblUser_data WHERE USER_ID = ? AND ISM_Authoriser ='Yes';""")        
                    Auth_list = View_query(Supportdb,query,record)           
                    if len(Auth_list) !=0:
                        CurrentStatus = "Auth - InProcess"         
                        query = ("Update tblMain set AuthoriserID =?, CurrentStatus =? Where UniqueID = ?;")
                        record = (User_ID, CurrentStatus, UniqueID)
                        Update_query(query,record)                                                                                      
                                
                    else:
                        messagebox.showwarning("Warning", "You don't have access to authorise, Kindly check with your team leader")
                        return False
                                            
                
                Input_Page(stframe, Sourcename = "Authorisation", UniqueID=UniqueID)
            except:
                pass            

        is_tree1.bind('<Double-1>', lambda event: Selected_tree1(event))
        is_tree2.bind('<Double-1>', lambda event: Selected_tree2(event))
                
        ############################# Viewed all input values in work queue  #############################

        #-------- Tree1 Viewed all input userdata data in work queue --------#
        
        conn = sqlite3.connect(dbpath)
        query = """SELECT ProcessDate, UserID, CaseReference, TransactionType, AccountNumber, Authorisation, Process_Status , Status, AuthStatus, UniqueID, MAX(PrimaryID) FROM tblInput WHERE 
                    UniqueID IN (Select UniqueID from tblMain WHERE CurrentStatus in ('IP - In Process', 'IP - Diarised', 'IP - Re-update Required', 'IP - Rejected')) 
                        GROUP BY UniqueID HAVING UserID = ? AND Process_Status IN ('In Process', 'Diarised', 'Re-update Required', 'Rejected');"""
        User_data = [User_ID]
        c_conn = conn.execute(query,User_data);
        rows = c_conn.fetchall();
        conn.close()

        for rw in rows:                
            is_tree1.insert("",tkinter.END,values=rw)
        
        ################--- Tree2 Viewed all authorisation data in dashboard ---################

        def radio_selected():
        #-------- My Work data in Authorisation --------#
            select_radio = Is_Options.get()        
            if select_radio ==1:
                is_tree2.delete(*is_tree2.get_children())
                conn = sqlite3.connect(dbpath)
                query = """SELECT ProcessDate, UserID, CaseReference, TransactionType, AccountNumber, B.AuthoriserID, B.CurrentStatus, Authorisation, Process_Status, A.UniqueID, Status, AuthStatus, MAX(PrimaryID) FROM tblInput AS A 
                            INNER JOIN (Select AuthoriserID, CurrentStatus, C.UniqueID from tblMain AS C) AS B
                            ON A.UniqueID = B.UniqueID
                            WHERE A.UniqueID IN (Select D.UniqueID from tblMain AS D WHERE Authorisation = 'Yes' AND CurrentStatus in ('IP - Completed', 'Auth - InProcess', 'Auth - Unassigned', 'IP - Re-update Done')) 
                            GROUP BY A.UniqueID HAVING B.AuthoriserID = ? AND Process_Status IN ('Completed', 'Re-update Done');"""

                User_data=[User_ID]
                c_conn = conn.execute(query,User_data)
                rows = c_conn.fetchall()
                conn.close()
                
                for i in rows:
                    is_tree2.insert("",tkinter.END,values=i)
                    
            elif select_radio ==2:  
            #-------- AllWork data in Authorisation --------#        
                is_tree2.delete(*is_tree2.get_children())
                conn = sqlite3.connect(dbpath)
                query = """SELECT ProcessDate, UserID, CaseReference, TransactionType, AccountNumber, B.AuthoriserID, B.CurrentStatus, Authorisation, Process_Status, A.UniqueID, Status, AuthStatus, MAX(PrimaryID) FROM tblInput AS A 
                            INNER JOIN (Select AuthoriserID, CurrentStatus, C.UniqueID from tblMain AS C) AS B
                            ON A.UniqueID = B.UniqueID
                            WHERE A.UniqueID IN (Select D.UniqueID from tblMain AS D WHERE Authorisation = 'Yes' AND CurrentStatus in ('IP - Completed', 'Auth - InProcess', 'Auth - Unassigned', 'IP - Re-update Done')) 
                            GROUP BY A.UniqueID HAVING Process_Status IN ('Completed', 'Re-update Done');"""
                c_conn = conn.execute(query)
                rows = c_conn.fetchall()
                conn.close()            
                
                for i in rows:
                    is_tree2.insert("",tkinter.END,values=i)
                
        Is_Options = IntVar()
        Is_Options.set(1)
        radio_selected()
        
        #-------- Refresh the input & Auth userdata data in work queue --------#
        def refresh_click():
            #messagebox.showinfo("alert","update")
            global active_page
            active_page = False
            Work_Queue_Check(stframe)
            
        Rd1 = Radiobutton(can_dash,text="My Works", variable=Is_Options, value=1,command=radio_selected, bg='white', fg='black', activeforeground='red', selectcolor='white', font=("Calibri",10,"bold"))
        Rd1.place(relx=0.910,rely=0.026)
        Rd2 = Radiobutton(can_dash,text="All Works", variable=Is_Options, value=2,command=radio_selected, bg='white', fg='black', activeforeground='red', selectcolor='white', font=("Calibri",10,"bold"))
        Rd2.place(relx=0.820,rely=0.026)
        But5 = Button(can_dash,text="Refresh", width=10,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=refresh_click)
        But5.place(relx=0.01,rely=0.015)
        
    ######################################################## Work Queue End ###################################################################


    def Inputpage_check(stframe): 
        global active_page       
        if active_page == True:                    
            output = messagebox.askquestion("Job not created", 'Are you sure you want to exit without submitting?')
            
            if output == "yes":
                active_page = False
                Input_Page(stframe)
        elif active_page == False:
            Input_Page(stframe)


    ######################################################## Input Page Start #################################################################

    def Input_Page(stframe, Sourcename ='', UniqueID ='' ):
        global active_page
        active_page = True        
        global NPHours
        global But1, But2, But4
        
        But1.configure(background ='#00728F')
        But2.configure(background ='sky blue')
        But4.configure(background ='#00728F')
        But6.configure(background ='#00728F')
        But7.configure(background ='#00728F')
        
        can1 = Canvas(stframe,bg="white", height=515,width=1178,highlightthickness=0)
        can1.place(relx=0.00,rely=0.11)
            
        
        #-------- Gift Transfer Canvas and Entry  --------#
        can3 = Canvas(can1, bg="white", height=500,width=620,highlightthickness=0)
        Ent9 = Entry(can3, width=15, validate= "key", bg="white", font=("Calibri",11),highlightbackground=None,highlightcolor=None)
        Ent9['validatecommand'] = (Ent9.register(AcceptNum),'%P','%d')
        
        Input_starttime =datetime.now().strftime('%d-%m-%Y %H:%M:%S')
        NPHours =datetime.min
        
        gift_combo ={}
        gift_entry ={}    

        #--------  Input Dropdown values --------#

        def Com_select1(e):
            Cb2.delete(0,END)
            com_val1 = Cb1.get()

            conn =sqlite3.connect(dbpath)
            cur = conn.cursor()
            com_query = " Select * from tblProcess_data2 where Modetype= ? "
            combb = cur.execute(com_query, (com_val1,))
            rows = combb.fetchall()
            conn.close()
            dd =[]

            for i in rows:
                dd.append(i[1])
                                                   
            if len(Cb1.get())>0:
                if Cb1.get() not in com_list2:
                    messagebox.showerror("Incorrect Channel", "Kindly Select Valid Request Channel")                                    
                    Cb1.focus_set()
                    Cb1.delete(0, END)                    
                    return False
            
            Cb2.config(state = 'Enable')
            Cb2.config(completevalues=dd)
            
            #--------  Case Reference  --------#

            if len(com_val1)==0:
                Label7.config(text="Case Reference")
                Check1.deselect()
                Check1.config(state='disable')
                
                Cb2.delete(0,END)
                Cb2.config(completevalues =[''])
                Cb2.config(state = 'disable')
                            
            elif com_val1 == 'Sirius':
                Check1.config(state='normal')
                Label7.config(text= "Work Request")
                
            elif com_val1 =='CRM':
                Label7.config(text= 'Case Reference')
                Check1.config(state='disable')
                Check1.deselect()
                
            elif com_val1 =='CC':
                Label7.config(text= 'Case Reference')
                Check1.config(state='normal')

            elif com_val1 =='Inbox':
                Label7.config(text= 'Email')
                #Check1.deselect()
                Check1.config(state='normal')
                            
            elif com_val1 =='Report':
                Label7.config(text= 'Case Reference')
                Check1.deselect()
                Check1.config(state='disable')
        

        def Com_select2(e):        
            query = " Select * from tblProcess_data2 where Modetype= ? "
            record = [Cb1.get()]
            Com_query2 = View_query(dbpath,query, record)
            transction_list = []
            for r in Com_query2:
                transction_list.append(r[1])
            if len(Cb2.get())>0:
                if Cb2.get() not in transction_list:
                    messagebox.showerror("Incorrect Transactions", "Kindly Select Valid Transactions")
                    Cb2.focus_set()                           
                    Cb2.delete(0, END)
                    return False
            
            
            Cb4.delete(0,END)
            Com_val1 = Cb2.get()
            com_query4 = sqlite3.connect(dbpath)
            cur = com_query4.cursor()
            sql_qury1 = "select * from tblProcess where Transactiontype = ?"
            cur.execute(sql_qury1, (Com_val1,))
            rows = cur.fetchall();
            com_query4.close()
            com_list4=[]
            
            for i in rows:
                com_list4.append(i[1])

            Cb4.config(values= com_list4)
            Com_val2 = Cb2.get()            
            Check1.deselect()
            
            if Com_val2 == "Cheque Banking" or  Com_val2== "Amalgamation" or Com_val2 == "CSN Transfers":
                Ent1.config(state='normal')
                Ent2.config(state='normal')
                Check2.config(state='normal')
                Check2.select()
                Cb4.config(state = 'normal')

            elif Com_val2 == "Allocate Transactions" :
                Ent1.delete(0,END)
                Ent2.delete(0,END)
                Ent1.config(state='disable')
                Ent2.config(state='disable')
                Check2.config(state='disable')
                Cb4.config(state = 'disable')
                Check2.deselect()

            elif Com_val2 == "Section 793" :
                Ent2.delete(0,END)
                Ent1.config(state='normal')
                Ent2.config(state='disable')
                Check2.config(state='disable')
                Cb4.config(state = 'disable')
                Check2.deselect()

            elif len(com_list4)==0:
                Ent1.config(state='normal')
                Ent2.config(state='normal')
                Check2.config(state='disable')
                Cb4.delete(0, END)
                Cb4.config(state = 'disable')
                Check2.deselect()

            elif var_1.get() == 0:
                Ent1.config(state='normal')
                Ent2.config(state='normal')
                Check2.config(state='normal')
                Cb4.delete(0, END)
                # Cb4.config(state = 'disable')
                # Check2.deselect()

            #-------- Closer new frame created --------#
            Gift_list = ['Gift Transfer', 'Re-Materialisation', 'Amalgamation', 'Certificated Stock Deposits', 'CSN Transfers', 
                                     'Account Closure', 'Change of Data', 'Third Parties', 'POA/COP', 'CTF Account Locking', 'BACS']
            if var_1.get() == 0 and Com_val1 in Gift_list :
                
                can3.place_configure(relx=0.450,rely=0.08,width=450)
                Ent9.delete(0,END)
                Cb4.config(state = 'normal')
                Cb4.delete(0, END)
                Check2.select()
                Cb4.configure(state = 'disable')
                Ent9.place(relx=0.03,rely=0.008,height=23)                

                can4 = Canvas(can3, bg="white",width=400, height=350,highlightthickness=0, highlightbackground=None,highlightcolor=None)
                can4.grid(row=0, column=0, padx = (5,0), pady=(50, 0), sticky="news")

                scrollbar = Scrollbar(can3, orient="vertical", command=can4.yview,highlightthickness=0)
                scrollable_frame = Canvas(can4, bg="white",highlightthickness=0, highlightbackground=None,highlightcolor=None)
                scrollable_frame.bind("<Configure>", lambda e: can4.configure(scrollregion=can4.bbox("all")))

                can4.create_window((0, 0), window=scrollable_frame, anchor="nw")
                can4.configure(yscrollcommand=scrollbar.set)

                def deselect_entry():
                    for r in scrollable_frame.grid_slaves():
                        if int(r.grid_info()["row"])>=0:
                            r.grid_forget()
                    #can4.place_forget()
                    scrollbar.grid_forget()
                    #Ent9.delete(0,END)

                def deselectaccount():
                    for r in scrollable_frame.grid_slaves():
                        if int(r.grid_info()["row"])>=0:
                            r.grid_forget()
                    #can4.place_forget()
                    scrollbar.grid_forget()
                    Ent9.delete(0,END)
                
                def entry_selected():
                    # global my_combo, my_entry2
                    
                    if Ent9.get() == "":
                        messagebox.showerror("Alert","Please update the appropriate values")
                        
                    elif int(Ent9.get()) ==0:
                        messagebox.showerror("Warning","Enter the valid count!")
                        Ent9.delete(0,END)

                    elif int(Ent9.get()) >= 1 and int(Ent9.get()) <=50:
                        # entry_val1 = Ent9.get()
                        
                        #if Com_val1 == "Gift Transfer" or  Com_val1 == "Re-Materialisation" or Com_val1 == "Amalgamation":                        
                        deselect_entry()                            
                            
                        for r in range(int(Ent9.get())):                                                                
                            my_label = Label(scrollable_frame, width=5, font=("Calibri (Body)", 10, "bold"))
                            my_label.grid(row=r, column=0,pady=5, padx=10)
                            my_label.config(text=r+1)
                            my_entry2 = Entry(scrollable_frame,font=("Calibri (Body)", 10),highlightthickness=1)
                            my_entry2.grid(row=r,column=1, pady=5,padx=10)
                            gift_entry[r] = my_entry2
                            if Com_val1 == "Gift Transfer" or  Com_val1 == "Re-Materialisation" or Com_val1 == "Amalgamation":
                                Auth_screen = ['DESM','OAT','BOTH']
                            elif Com_val1 == "Certificated Stock Deposits" or Com_val1 == "CSN Transfers":
                                Auth_screen = ['CSD','CSN','BOTH']
                            elif Com_val1 == "Account Closure" or Com_val1 == "Change of Data":
                                Auth_screen = ['Account Screen','Customer Screen', 'Linked Account Screen']
                            elif Com_val1 == "Third Parties" or Com_val1 == "POA/COP":
                                Auth_screen = ['Customer Screen', 'Linked Account Screen']
                            elif Com_val1 == "CTF Account Locking" or Com_val1 == "BACS":
                                Auth_screen = ['Bank Screen', 'Customer Screen', 'Linked Account Screen']
                            my_combo = AutocompleteCombobox(scrollable_frame,completevalues=Auth_screen,font=("Calibri (Body)", 10))
                            my_combo.grid(row=r, column=2,pady=5,padx=10)
                            gift_combo[r]=my_combo
                            scrollbar.grid(row=0, column=1, padx = (5,0), pady=(50, 0), sticky='ns')

                        # elif Com_val1 == "Certificated Stock Deposits" or Com_val1 == "CSN Transfers":
                        #     deselect_entry()

                        #     for r in range(int(Ent9.get())):                                
                        #         my_label = Label(scrollable_frame, width=5, font=("Calibri (Body)", 10, "bold"))
                        #         my_label.grid(row=r, column=0,pady=5, padx=10)
                        #         my_label.config(text=r+1)
                        #         my_entry2 = Entry(scrollable_frame,font=("Calibri (Body)", 10),highlightthickness=1)
                        #         my_entry2.grid(row=r,column=1, pady=5,padx=10)
                        #         gift_entry[r]= my_entry2
                        #         my_combo = AutocompleteCombobox(scrollable_frame,completevalues=['CSD','CSN','BOTH'],font=("Calibri (Body)", 10))
                        #         my_combo.grid(row=r, column=2,pady=5,padx=10)
                        #         gift_combo[r] = my_combo
                        #         scrollbar.grid(row=0, column=1, padx = (5,0), pady=(50, 0), sticky='ns')                            

                    else:
                        messagebox.showerror("Alert","Kindly update below 50 entrys ")
                        Ent9.delete(0,END)                

                but10 = Button(can3, text="Add",width=10, command=entry_selected,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)
                but10.place(relx = 0.300, rely=0.008)
                
                but11 = Button(can3, text="Remove",width=10, command=deselectaccount,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)
                but11.place(relx = 0.600, rely=0.008)
                
            else:            
                can3.place_forget()
                
        #-------- Checkbox click(Cannot Locate) based fields on changes --------#

        def Checkbox_select1():

            if var_1.get() == 1:
                can3.place_forget()
                #Ent1.delete(0,END)
                Ent1.config(state='normal')
                Ent2.delete(0,END)
                Ent2.config(state='disable')
                Ent3.config(state='disable')
                Check2.config(state='disable')
                Cb4.delete(0,END)
                Cb4.config(state='disable')
                Cb5.delete(0,END)
                Cb5.insert(END, "Cannot Locate")
                # Cb5.config(state = 'normal')
                Check2.deselect()
                
            elif var_1.get() == 0:
                Ent2.config(state='normal')
                Ent3.config(state='normal')
                Check2.config(state='normal')            
                Cb5.delete(0,END)
                Ent1.config(state='normal')
                Cb2.delete(0,END)
                can3.place_forget()
                

        def Checkbox_select2():
            if var_2.get() == 1:
                Cb4.delete(0, END)
                Cb4.config(state = 'normal')                
                # Autho= "Yes"
            elif var_2.get() == 0:                
                Cb4.delete(0, END)
                Cb4.config(state = 'disabled')
                # Autho = "No"

        var_1= IntVar()
        var_2 = IntVar()

        Label3 = Label(can1, text="INPUT",width=15,height=1,fg="black", bg="white",font=("Calibri (Body)",13,"bold"))
        Label3.place(relx=0.150,rely=0.02)
        
        TimerLabel = Label(can1, text="Timer: " + "00:00:00",width=15,height=1,fg="#054457", bg="white",font=("Calibri (Body)",11,"bold"))
        TimerLabel.place(relx=0.88, rely=0.001)
        Timer1=TimerRun(TimerLabel)

        com_list2 = Select_data(dbpath, "SELECT DISTINCT(Modetype) FROM tblProcess_data2")
        Label5 = Label(can1,text="Mode of Request",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label5.place(relx=0.03,rely=0.10)
        Cb1 = AutocompleteCombobox(can1,width=23, completevalues=com_list2, font=("Calibri",11))
        Cb1.place(relx=0.03,rely=0.15)
        Cb1.bind("<<ComboboxSelected>>", Com_select1)
        Cb1.bind("<FocusOut>", Com_select1)

        Label6 = Label(can1,text="Transaction",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label6.place(relx=0.25,rely=0.10)
        Cb2 = AutocompleteCombobox(can1, width=23,state="disabled", font=("Calibri",11,))
        Cb2.place(relx=0.25,rely=0.15)
        Cb2.bind("<<ComboboxSelected>>", Com_select2)
        Cb2.bind("<FocusOut>", Com_select2)

        Label7 = Label(can1, text = "Case Reference", fg="#515056",bg="White",bd=0,font=("Calibri (Body)", 10, "bold"))
        Label7.place(relx=0.03,rely=0.25)
        Ent1 = Entry(can1, width=25, bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)
        Ent1.place(relx=0.03,rely=0.30,height=23)
        
        Label8 = Label(can1,text="Account Number",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label8.place(relx=0.25,rely=0.25)
        Check1 = Checkbutton(can1,variable=var_1,bg="white",text="C/L",font=("Calibri (Body)", 10, "bold"),  command=Checkbox_select1, state='disable')
        Check1.place(relx=0.35,rely=0.25)
        
        Ent2 = Entry(can1, width=25,bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)
        Ent2.place(relx=0.25,rely=0.30,height=23)

        Label9 = Label(can1,text="No. of Items",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label9.place(relx=0.03,rely=0.40)
        Ent3 = Entry(can1, width=25,bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)
        Ent3.insert(0,1)
        Ent3.place(relx=0.03,rely=0.45,height=23)

        Label10 = Label(can1,text="Authorisation",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label10.place(relx=0.25,rely=0.40)
        Check2 = Checkbutton(can1,variable=var_2,bg="white", command=Checkbox_select2)
        Check2.place(relx=0.34,rely=0.40)
        Cb4 = AutocompleteCombobox(can1, width=23,font=("Calibri",11))
        Cb4.place(relx=0.25,rely=0.45)
        
        Com_list5 = ['Completed', 'Diarised', 'In Process', 'Cancelled']
        def com_selected5(e):
            
            if len(Cb5.get())>0:
                    
                    if Cb5.get() not in Com_list5:
                        messagebox.showerror("Incorrect Transactions", "Kindly Select Valid Transactions")
                        Cb5.focus_set()                           
                        Cb5.delete(0, END)
                        return False                            
        
        Label11 = Label(can1,text="Status",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label11.place(relx=0.03,rely=0.55)
        
        Cb5 = AutocompleteCombobox(can1,completevalues=Com_list5, width=23,font=("Calibri",11))
        Cb5.place(relx=0.03,rely=0.60)
        Cb5.bind("<<ComboboxSelected>>", com_selected5)
        Cb5.bind("<FocusOut>", com_selected5)
        

        Label15 = Label(can1,text="Comments",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        Label15.place(relx=0.03,rely=0.70)
        Ent4 = Text(can1, width=35,bg="white",font=("Calibri",10),highlightbackground=None,highlightcolor=None)
        Ent4.place(relx=0.03,rely=0.75,height=40)
        Ent4.bind('<Tab>', lambda event: focusNext(Ent4))
        Ent4.bind('<Shift-Tab>', lambda event: focusPrev(Ent4))
                

        #############################  Input & Re-update Sumbit function checking #############################

        def Sumbitcheck():
                        
            if UniqueID == '':
                Production_submit()
            elif UniqueID != '' and Sourcename == 'Input':                                   
                Reupdate_Psubmit()
            elif UniqueID != '' and Sourcename == 'Authorisation':
                Authorisation_Submit(UniqueID)
                

        #############################  User production data update in database #############################

        def Production_submit():
            global active_page
            global NPHours
            # global ModeofRequest,TransactionType,CaseReference,AccountNumber,NoofItems,AuthorisationScreen,InputID, my_entry2,my_combo
            
            
            UniqueID = user_name + datetime.now().strftime('%d%m%Y%H%M%S')
            #today = dt.datetime.today()
            ProcessDate = datetime.now().strftime('%d-%m-%Y')
            UserID= user_name            

            if var_1.get() ==1:
                CL = "Yes"
                AccountNumber = 1
            else:
                CL="No"

            CC=CL
            ModeofRequest = Cb1.get()
            TransactionType = Cb2.get()
            CaseReference= Ent1.get().strip()
            AccountNumber = Ent2.get().strip()
            NoofItems = Ent3.get().strip()
            
            if var_2.get()==0:
                auth="No"
                AuthStatus = "Not Required"
                # ipstauts = "IP - "
            else:
                auth="Yes"
                AuthStatus = "Not Stated" 
                # ipstauts = "Auth - "

            Authorisation = auth
            AuthorisationScreen = Cb4.get()
            Status = Cb5.get()
            StartTime = Input_starttime
            EndTime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')
            # Break_Hrs = str(NPHours)[-8:]
            Break_Hrs = NPHours.strftime('%H:%M:%S')
            Comments=Ent4.get(1.0,END).strip()
            
            Gift_list = ['Gift Transfer', 'Re-Materialisation', 'Amalgamation', 'Certificated Stock Deposits', 'CSN Transfers', 
                                     'Account Closure', 'Change of Data', 'Third Parties', 'POA/COP', 'CTF Account Locking', 'BACS']
            
            #-------- Input process status check --------#  
            if auth == "Yes" and Status == "Completed":
                Ipstatus = 'Auth - Unassigned'
                Process_Status = Cb5.get()                
            else:
                Process_Status = Cb5.get()
                Ipstatus = 'IP - ' + Process_Status

            #-------- Required fields check & import data in database --------#
            if len(ModeofRequest) == 0  or len(TransactionType)== 0:
                messagebox.showwarning("Warning","Kindly update the required fields!")
                return False
            
            elif TransactionType == 'Section 793':
                if len(CaseReference) ==0 or len(Status)==0 :
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False
            
            elif TransactionType == 'Allocate Transactions':
                if len(Status)==0 :
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False
            
            elif var_1.get() == 1:
                if len(ModeofRequest) == 0 or len(TransactionType) ==0 or len(CaseReference) ==0:
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False  
            
            elif var_2.get() == 1 and TransactionType not in Gift_list:
                if len(AuthorisationScreen) == 0 or len(NoofItems) ==0 or len(Status)==0 or len(AccountNumber) ==0 :
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False     
                # elif len(AuthorisationScreen) == 0: 
                #     messagebox.showwarning("Warning","Kindly update the required fields!")
                #     return False              
            
            elif len(ModeofRequest) == 0 or len(TransactionType) ==0  or len(NoofItems) ==0 or len(Status)==0 or len(AccountNumber) ==0:
                messagebox.showwarning("Warning","Kindly update the required fields!")
                return False                      
                                                
            #-------- Gift account validation --------#
            if auth == "Yes" and TransactionType in Gift_list:

                GiftUniqID = UniqueID               
                entry_val1 = Ent9.get()                
                
                
                if len(entry_val1) ==0:
                    messagebox.showerror("Alert", 'Please update the Gift Transfer count.')                                    
                    # gtentry = entry_val1
                    return False
                
                elif int(entry_val1) == 0 :
                    if len(AuthorisationScreen) == 0:
                        messagebox.showwarning("Warning","Should be updated the AuthorisationScreen fields!")                    
                        return False
                    
                elif int(entry_val1) >0 and len(AuthorisationScreen) == 1:
                    messagebox.showwarning("Warning","Please update the Gift Transfer count is Zero!")                    
                    return False
                       
            #-------- Gift account fields check --------#

                for rw in range(int(entry_val1)): 
                    try:
                        Reference = gift_entry[rw].get()
                        AuthScreen = gift_combo[rw].get()
                        
                        if len(Reference) == 0 or len(AuthScreen) == 0:                    
                            messagebox.showerror("Alert", "Kindly update the Gift Transfer fields!")
                            #gcrosscheck = 0
                            return False
                    except KeyError:
                        messagebox.showwarning('Warning', 'Please update the Gift Transfer count is Zero!')
                        return False
                i =0

                for rw in range(int(entry_val1)):
                    
                    Reference = gift_entry[rw].get()
                    AuthScreen = gift_combo[rw].get()
                    GiftAuthStatus = 'Inprocess'   
                    GiftStatus  =''            
                                    
                    if AuthScreen == 'BOTH':
                        i= i + 1
                        Giftaccount = i  

                        if Cb2.get() == "Certificated Stock Deposits" or Cb2.get() == "CSN Transfers" :
                            AuthScreen = "CSD"
                        elif Cb2.get() == "Gift Transfer" or Cb2.get() == "Re-Materialisation" :
                            AuthScreen = "OAT"
                        elif Cb2.get() =="Amalgamation":
                            AuthScreen = "DESM"

                        Reference = gift_entry[rw].get() 
                        Insert_column = "INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?);"
                        Insert_hd = [GiftUniqID, Giftaccount, Reference, AuthScreen, GiftAuthStatus, GiftStatus]
                        import_data(dbpath,Insert_column,Insert_hd)
                        i = i + 1                        
                        Giftaccount = i 

                        if Cb2.get() == "Certificated Stock Deposits" or Cb2.get() == "CSN Transfers" :
                            AuthScreen = "CSN"
                        elif Cb2.get() == "Gift Transfer" or Cb2.get() == "Re-Materialisation" or Cb2.get() =="Amalgamation":
                            AuthScreen = "DESM"

                        Reference = gift_entry[rw].get() 
                        Insert_column = "INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?);"
                        Insert_hd = [GiftUniqID, Giftaccount, Reference, AuthScreen, GiftAuthStatus, GiftStatus]
                        import_data(dbpath,Insert_column,Insert_hd)
                        #messagebox.showerror("Alert", "gift account updated!")
                    else:
                        i = i + 1
                        Giftaccount = i 
                        Insert_column = "INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?);"
                        Insert_hd = [GiftUniqID, Giftaccount, Reference, AuthScreen, GiftAuthStatus, GiftStatus]
                        import_data(dbpath,Insert_column,Insert_hd)                                                            
                    
                #messagebox.showinfo("Infomation", 'Gift Transfer job submitted')
                                                
                            
            Insert_column = "INSERT INTO tblInput (UniqueID, ProcessDate, UserID,ModeofRequest, CC, TransactionType, CaseReference, AccountNumber, NoofItems, Authorisation, AuthorisationScreen, Status, Comments, StartTime, EndTime, Break_Hrs, AuthStatus, Process_Status) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);"
            Insert_hd = [UniqueID, ProcessDate, UserID, ModeofRequest, CC, TransactionType, CaseReference, AccountNumber, NoofItems, Authorisation, AuthorisationScreen, Status, Comments, StartTime, EndTime, Break_Hrs, AuthStatus, Process_Status]
            import_data(dbpath,Insert_column,Insert_hd)

            #-------- Required data in Main table database --------#                
            InputUserID = UserID
            AuthoriserID =''
            CurrentStatus =  Ipstatus
            Insert_column =  "INSERT INTO tblMain (UniqueID, InputUserID, AuthoriserID, Authorisation, CurrentStatus) VALUES (?,?,?,?,?);"
            Insert_hd  = [UniqueID, InputUserID, AuthoriserID, Authorisation, CurrentStatus]
            import_data(dbpath,Insert_column,Insert_hd)
            
            messagebox.showinfo("INFORMATION", 'Job submitted sucessfully')
            
            NPHours = datetime.min
            Cb1.delete(0,END)
            Cb2.delete(0,END)
            Cb2.config(state='disable')
            Ent1.delete(0,END)
            Ent2.delete(0,END)
            Cb4.delete(0,END)
            Cb5.delete(0,END)
            Check2.deselect()
            Check1.deselect()
            Ent4.delete(1.0,END)
            Input_Page(stframe)
            active_page = False
                                
        #############################   input pages Submit End #############################
        
        But8 = Button(can1,text="Submit", width=12,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=Sumbitcheck)
        But8.place(relx=0.32,rely=0.90)
        #Cb1.focus()
                
        #-------- Input Treeview1 review --------#   

        if UniqueID != '' and Sourcename == 'Input':        
                        
            Reinput_starttime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')        
            NPHours =datetime.min
            gift_combo1 ={}
            gift_entry1 ={}
            gift_label1 =[]
            query = ("""Select * , MAX(PrimaryID) FROM tblInput WHERE UniqueID = ?;""")
            UniqueID = [UniqueID]
            Output = View_query(dbpath,query,UniqueID)         

            Cb1.insert(0,Output[0][4])
            Request = Output[0][4]            
            Cb2.config(state = 'normal')
            CC = [Output[0][5]]            
            TransactionType = [Output[0][6]]        
            Cb2.insert(0,TransactionType[0])
            Ent1.insert(0,Output[0][7])
            Ent2.insert(0,Output[0][8])
            Authorisation = Output[0][10]
            Cb4.insert(0, Output[0][11])
            Cb5.insert(0, Output[0][12])
            Ent4.insert(END,Output[0][13])                        
            
            Giftvalidation =''
            query= ("Select Authorisationscreen from tblProcess Where Transactiontype =?")
            com_query4 = Viewtable_data(dbpath, query, TransactionType)                                                            
            Cb4.config(completevalues = com_query4) 
            
            #-------- Transaction type in tblProcess_data2 --------# 
            
            query= ("Select Transactions from tblProcess_data2 Where Modetype =?")
            Transaction_query = Viewtable_data(dbpath, query, [Request])                                                            
            
            
            #-------- Transaction type base fields changes --------# 
            
            if TransactionType == ['Allocate Transactions']:
                if CC == ["Yes"]:
                    Ent2.config(state= 'disabled')
                    Check1.select()
                    Check1.config(state= 'normal')
                    Check2.config(state= 'disabled')
                    Cb4.config(state = "disable")  
                    Cb2.config(completevalues = Transaction_query) 
                else: 
                    Ent1.config(state= 'disabled')
                    Ent2.config(state= 'disabled')
                    Check2.deselect()
                    Check2.config(state= 'disabled')
                    Cb4.config(state = "disable")
                                 
            elif TransactionType == ['Section 793']:
                Ent2.config(state= 'disabled')
                Check2.deselect()
                Check2.config(state= 'disabled')
                Cb4.config(state = "disable") 
                
            elif Authorisation == "No" and CC == ["Yes"]:
                Check1.select()
                Check1.config(state= 'normal')
                Ent2.config(state= 'disabled')   
                Check2.config(state= 'disabled')
                Cb4.config(state = "disable")   
                Cb2.config(completevalues = Transaction_query)                             
            
            elif Authorisation == "Yes":
                Check2.select()
                Cb4.config(state = 'normal')                    
            
            elif Authorisation =="No":
                Check2.deselect()
                Cb4.config(state = "disable")
                
            # if var_1.get() == 0 :
            #     query= ("Select Transactions from tblProcess_data2 Where Transactiontype =?")
            #     com_query2 = Viewtable_data(dbpath, query, Request)                                                            
            #     Cb2.config(values = com_query2)
                                   

            # -------- Gift account fields view in authorisation  --------#

            # if TransactionType == ['Certificated Stock Deposits']:
            #     giftauthstatus = ['CSN','CSD']
            # else:
            #     giftauthstatus = ['OAT','DESM']
            
            if TransactionType[0] in  ["Gift Transfer", "Re-Materialisation", "Amalgamation"]:
                giftauthstatus = ['DESM','OAT']
            elif TransactionType[0] in ["Certificated Stock Deposits", "CSN Transfers"]:
                giftauthstatus = ['CSD','CSN']
            elif TransactionType[0] in ["Account Closure", "Change of Data"]:
                giftauthstatus = ['Account Screen','Customer Screen', 'Linked Account Screen']
            elif TransactionType[0] in ["Third Parties", "POA/COP"]:
                giftauthstatus = ['Customer Screen', 'Linked Account Screen']
            elif TransactionType[0] in ["CTF Account Locking", "BACS"]:
                giftauthstatus = ['Bank Screen', 'Customer Screen', 'Linked Account Screen']
            else:
                giftauthstatus = ['DESM','OAT']
            #print(TransactionType[0]) 

            
            can6 = Canvas(can1,bg="white", height=460,width=620,highlightthickness=0)
            Label21 = Label(can1, text="GIFT TRANSFER",width=15,height=1,fg="black", bg="white",font=("Calibri (Body)",13,"bold"))        
            Label22 = Label(can6,text="Gift ID",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))  
            Label23 = Label(can6,text="Reference",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
            Label24 = Label(can6,text="Auth Screen",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))      
            Ent7 = Entry(can6, width=20,bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)
            Ent8 = Entry(can6, width=20,bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)
            Cb11 = AutocompleteCombobox(can6,completevalues= giftauthstatus, width=23,  font=("Calibri",11))                
            #Cb11 = AutocompleteCombobox(can6, width=23,  font=("Calibri",11))         
            
        #-------- Tree3 Viewed all input userdata data in work queue --------#

            def InputGifttransfer():
                sty = ttk.Style()
                sty.theme_use('default')
                sty.configure("Treeview",background="white",foreground='black' ,fieldbackground='white')
                sty.configure('Treeview.Heading',background='#edf0f5',foreground='Black', font=("Calibri", 11, "bold"))
                is_tree3 = Treeview(can6,columns=("c1","c2","c3"), show='headings',height=22, highlightbackground=None,highlightcolor=None)
                is_tree3.column("#1",anchor=CENTER,width=65)
                is_tree3.heading("#1",text="Gift ID")
                is_tree3.column("#2",anchor=CENTER,width=100)
                is_tree3.heading("#2",text="Reference")
                is_tree3.column("#3",anchor=CENTER,width=80)
                is_tree3.heading("#3",text="Auth Screen")
                is_tree3.place(relx=0.05,rely=0.03,  height=380)

                scrollbar= Scrollbar(can6,orient="vertical",command=is_tree3.yview)
                scrollbar.place(relx=0.45,rely=0.03,height=380)
                is_tree3.configure(yscrollcommand= scrollbar.set)              

                conn = sqlite3.connect(dbpath)
                query = """SELECT GiftAccount, Reference, AuthScreen FROM tblinput_Giftaccount WHERE UniqID =? AND AuthStatus NOT IN ("Autorised", "Auto-Autorised", "Rejected") AND Status NOT IN ("Re-update");"""
                # query = ("SELECT GiftAccount, Reference, AuthScreen FROM tblinput_Giftaccount WHERE UniqID =? AND GiftAccount = (SELECT MIN(GiftAccount) from tblinput_Giftaccount WHERE UniqID =? AND AuthStatus = 'Inprocess');")
                # User_data = (UniqueID[0], UniqueID[0])
                User_data = UniqueID
                c_conn = conn.execute(query, User_data);
                rows = c_conn.fetchall();
                conn.close()

                for rw in rows:                
                    is_tree3.insert("",tkinter.END,values=rw)    
                
                is_tree3.bind('<<TreeviewSelect>>', lambda event: Selected_tree3(event, is_tree3))  

        # -------- Gift Transfer Detail add in Treeview3   --------#

            def Selected_tree3(event, is_tree3, itemselect = ''):
                
                #is_tree3.delete(*is_tree3.get_children())
                for item in is_tree3.selection():
                    item_select3 = is_tree3.item(item)
                    giftid =item_select3['values'][0]
                    # ReferenceNo =item_select3['values'][1]
                    # Authscreen =item_select3['values'][2]                                   
                                        
                query = ("SELECT * FROM tblinput_Giftaccount WHERE UniqID = ? and GiftAccount =?;")
                record = (UniqueID[0], giftid)
                Gifttransfer = View_query(dbpath, query, record)
                ReferenceNo = Gifttransfer[0][2]
                Authscreen = Gifttransfer[0][3]                         

                Ent7.config(state= 'normal')
                Ent7.delete(0, END)
                Ent7.insert(0, giftid)
                Ent7.config(state= 'disabled')

                Ent8.config(state= 'normal')
                Ent8.delete(0, END)
                Ent8.insert(0, ReferenceNo)                

                Cb11.config(state= 'normal')
                Cb11.delete(0, END)
                Cb11.insert(0, Authscreen)                                                                                                     
            
            Gift_list = ['Gift Transfer', 'Re-Materialisation', 'Amalgamation', 'Certificated Stock Deposits', 'CSN Transfers', 
                                     'Account Closure', 'Change of Data', 'Third Parties', 'POA/COP', 'CTF Account Locking', 'BACS']
            if  Authorisation == "Yes" and TransactionType[0] in Gift_list:
                Check2.config(state= 'disabled')
                Cb4.config(state = 'disabled')    
                can3.place_forget() 
                Giftvalidation = Label21.cget('text')
                can6.place(relx=0.450,rely=0.08)
                Label21.place(relx=0.650,rely=0.02)
                Label22.place(relx=0.55,rely=0.024)            
                Ent7.place(relx=0.55,rely=0.078)
                Ent7.config(state='disabled')
                Label23.place(relx=0.55,rely=0.15)
                Ent8.place(relx=0.55,rely=0.20)
                Label24.place(relx=0.55,rely=0.30)            
                Cb11.place(relx=0.55,rely=0.35, width=178) 
                InputGifttransfer()
                
                record = UniqueID
                auth_status = 'Inprocess'                                                        
                query = ("SELECT * FROM tblinput_Giftaccount WHERE UniqID =? and AuthStatus ='" + str(auth_status) + "' ;")
                com_list11 = Viewtable_data(dbpath,query,record)
                if len(com_list11) <=0:
                    Check2.config(state='normal') 
                else:
                    Check2.config(state= 'disabled')
                #print(len(com_list11)) 
                query = ("SELECT AuthScreen FROM tblinput_Giftaccount WHERE UniqID =? and AuthStatus ='" + str(auth_status) + "' ;")
                giftscreenlist = Viewtable_data(dbpath,query,record) 

                                        

                def Update_Giftaccount():
                    
                    ReferenceNo = Ent8.get().strip()
                    AuthScreen = Cb11.get()
                    GiftStatus = 'Re-update'
                    Giftid = Ent7.get()
                                                        
                    if len(ReferenceNo) == 0 or len(AuthScreen) == 0 or len(Giftid) == 0:
                        messagebox.showerror("Alert", "Kindly update required fields")
                        return False  
                    
                    else:              
                        query = ("Update tblinput_Giftaccount set Reference =?, AuthScreen = ?, Status =? Where UniqID = ? and GiftAccount =?;")
                        record = (ReferenceNo, AuthScreen, GiftStatus, UniqueID[0], Giftid)
                        Update_query(query,record)
                        InputGifttransfer()
                        Clear_Gifttransfer()
                    
                def UpdateAll_Giftaccount():
                    GiftStatus = 'Re-update'
                    record = UniqueID
                    query = ("SELECT Count(Status) FROM tblinput_Giftaccount WHERE UniqID =? and AuthStatus = 'Inprocess' AND (Status = '' or Status = 'done');")
                    Status_count = Viewtable_data(dbpath,query,record)
                    # print(Status_count)
                    if Status_count == [0] :
                        messagebox.showinfo("Alert", "Already Gift Transfer updated")
                        return False
                    else:
                        query = ("Update tblinput_Giftaccount set Status =? Where UniqID = ? AND  AuthStatus = 'Inprocess' and (Status = '' or Status = 'done');")
                        record = (GiftStatus, UniqueID[0])
                        Update_query(query,record)
                        InputGifttransfer()
                        Clear_Gifttransfer()
                                

                def Clear_Gifttransfer():
                    
                    Ent7.config(state='normal')
                    Ent7.delete(0,END)
                    Ent7.config(state='disabled')
                    Ent8.delete(0,END)
                    Cb11.delete(0,END)

                def Remove_Gifttransfer():  
                    ReferenceNo = Ent8.get().strip()
                    AuthScreen = Cb11.get()
                    Giftid = Ent7.get().strip()
                    if len(ReferenceNo) == 0 or len(AuthScreen) == 0 or len(Giftid) == 0:
                        messagebox.showerror("Alert", "Kindly select the Gift Transfer account.")
                        return False      
                    else:                      
                                  
                        query = ("DELETE FROM tblinput_Giftaccount WHERE UniqID =? and GiftAccount =?;")
                        record = (UniqueID[0], Giftid)
                        Delete_qury(query, record)
                        InputGifttransfer()
                        Clear_Gifttransfer()

                def Add_Gifttransfer():                
                    ReferenceNo = Ent8.get().strip()
                    AuthScreen = Cb11.get()
                    Authstatus = "Inprocess"
                    GiftStatus = 'Re-update'
                    
                    if len(ReferenceNo) == 0 and len(AuthScreen) == 0 :
                        messagebox.showerror("Alert", "Kindly update required fields")
                        return False
                    query = ("SELECT MAX(GiftAccount)+1 FROM tblinput_Giftaccount WHERE UniqID =?")
                    record = [UniqueID[0]]
                    giftcount = Viewtable_data(dbpath, query, record)                
                    
                    if not giftcount[0] :
                        Gift_count = 1
                    else:
                        Gift_count = giftcount[0]
                    
                    Insert_column = """INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?); """
                    Insert_hd = [UniqueID[0], Gift_count, ReferenceNo, AuthScreen, Authstatus, GiftStatus] 
                    import_data(dbpath,Insert_column, Insert_hd)
                    InputGifttransfer()
                    Clear_Gifttransfer()

                but12 = Button(can6, text="Update",width=8, command= lambda:Update_Giftaccount(),bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)             
                but12.place(relx = 0.50, rely=0.45)
                but13 = Button(can6, text="Add",width=8, command=lambda:Add_Gifttransfer(),bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)
                but13.place(relx = 0.65, rely=0.45)
                but14 = Button(can6, text="Remove",width=8, command=lambda:Remove_Gifttransfer(),bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)
                but14.place(relx = 0.80, rely=0.45)            
                but15 = Button(can6, text="UpdateAll",width=8, command=lambda:UpdateAll_Giftaccount(),bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)                        
                but15.place(relx = 0.50, rely=0.55)
                but16 = Button(can6, text="Clear",width=8, command=lambda:Clear_Gifttransfer(),bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3)                        
                but16.place(relx = 0.65, rely=0.55) 
                 
                
                # Ent7.insert(0, Giftacccount)                        
                # can7 = Canvas(can6, bg="white",width=400, height=350,highlightthickness=0, highlightbackground=None,highlightcolor=None)
                # can7.grid(row=0, column=0, padx = (5,0), pady=(50, 0), sticky="news")

                # scrollbar = Scrollbar(can6, orient="vertical", command=can7.yview,highlightthickness=0)
                # scrollable_frame = Canvas(can7, bg="white",highlightthickness=0, highlightbackground=None,highlightcolor=None)
                # scrollable_frame.bind("<Configure>", lambda e: can7.configure(scrollregion=can7.bbox("all")))

                # can7.create_window((0, 0), window=scrollable_frame, anchor="nw")
                # can7.configure(yscrollcommand=scrollbar.set)
                # r = StringVar()                            
                
                # for r in range(int(Ent7.get())):     

                #         my_label = Entry(scrollable_frame,text=r+1, width=5, font=("Calibri (Body)", 10, "bold"))
                #         my_label.grid(row=r, column=0,pady=5, padx=10)      
                #         my_label.insert(0, r+1)              
                #         #my_label.config(text='label' + str(r+1))
                #         #gift_label1[r]= my_label.cget('r')
                #         #print(my_label.cget('text'))                    
                                    
                #         my_entry2 = Entry(scrollable_frame,font=("Calibri (Body)", 10),highlightthickness=1)
                #         my_entry2.grid(row=r,column=1, pady=5,padx=10)
                #         my_entry2.insert(0, com_list11[r])
                #         gift_entry1[r] = my_entry2   
                #         #print(gift_entry1[r].get())                 
                #         my_combo = AutocompleteCombobox(scrollable_frame,completevalues=['DESM','OAT','CSN', 'CSD'],font=("Calibri (Body)", 10))
                #         my_combo.grid(row=r, column=2,pady=5,padx=10)
                #         my_combo.insert(0, giftscreenlist[r])
                #         gift_combo1[r]=my_combo
                #         scrollbar.grid(row=0, column=1, padx = (5,0), pady=(50, 0), sticky='ns')            
                                
                Check2.select()
                Cb4.config(state = 'disable')       
            
            else:
                Label21.place_forget()
                Cb11.place_forget()
                Label22.place_forget()
                Label23.place_forget()                 
    
    
    #############################   Authorisation Treeview2 review   #############################  

        #def Inputrework(UniqueID):
        if UniqueID != '' and Sourcename == "Authorisation": 
            
            Reauth_starttime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')      
            NPHours = datetime.min
            record = [UniqueID]   
            query = ("""Select * , MAX(PrimaryID) FROM tblInput WHERE UniqueID = ?;""")        
            AuthOutput = View_query(dbpath,query,record) 
            
            # -------- Inprocess Input data review  --------#
            Auth_date = AuthOutput[0][2]
            Inputuserid = AuthOutput[0][3]        
            Cb1.insert(0,AuthOutput[0][4])
            
            Cb1.config(state = 'disable')        
            TransactionType = [AuthOutput[0][6]]        
            Cb2.config(state = 'normal')
            Cb2.insert(0,TransactionType[0])        
            Cb2.config(state = 'disable')
            Ent1.insert(0,AuthOutput[0][7])
            Ent1.config(state='readonly')
            Ent2.insert(0,AuthOutput[0][8])
            Ent2.config(state= 'readonly')
            Ent3.config(stat='readonly')
            Authorisation = AuthOutput[0][10]
            Cb4.insert(0, AuthOutput[0][11])
            Cb4.config(state = 'disabled')
            Cb5.insert(0, AuthOutput[0][12])
            Cb5.config(state = 'readonly')
            Ent4.insert(END,AuthOutput[0][13])   
            Ent4.config(bg ='#f2f2f2')                        
            Ent4.config(state='disable') 
            
            Check2.select()
            Check2.config(state='disabled')                                                                          

            can2 = Canvas(can1,bg="white", height=460,width=620,highlightthickness=0)
            can2.place(relx=0.450,rely=0.08)
            Label4 = Label(can1, text="AUTHORISATION",width=15,height=1,fg="black", bg="white",font=("Calibri (Body)",13,"bold"))
            Label4.place(relx=0.650,rely=0.02)

            Label12 = Label(can2,text="Process Date",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
            Label12.place(relx=0.03,rely=0.025)
            date_ent1 = DateEntry(can2, background= "black", foreground= "white",bd=0,font=('Calibri',11), date_pattern='dd/mm/yyyy')
            date_ent1.set_date(Auth_date)
            date_ent1.place(relx=0.03,rely=0.08, width=178, height=23)

            Label13 = Label(can2,text="Input UserName",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
            Label13.place(relx=0.50,rely=0.025)
            Ent5 = Entry(can2, width=25,bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)
            Ent5.place(relx=0.50,rely=0.08,height=23)
            Ent5.insert(0,Inputuserid)
            Ent5.config(state= "readonly")

            Label14 = Label(can2,text="Reference",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))        
            Cb6 = AutocompleteCombobox(can2,width=23, font=("Calibri",11))        

            Label16 = Label(can2,text="Auth Screen",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))        
            Ent6 = Entry(can2, width=25,bg="white",font=("Calibri",11),highlightbackground=None,highlightcolor=None)                      

            Label17 = Label(can2,text="Authorisation Status",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
            Label17.place(relx=0.03,rely=0.36)
            Cb7 = AutocompleteCombobox(can2, width=23,completevalues=['Autorised','Rejected', 'Re-update Required', 'Auto-Autorised'],  font=("Calibri",11))
            Cb7.place(relx=0.03,rely=0.415)
            
            Label18 = Label(can2,text="Comments",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
            Label18.place(relx=0.50,rely=0.36)
            Text_ent1 = Text(can2, width=23, bg="#f2f2f2",font=("Calibri (Body)",10),highlightbackground=None,highlightcolor=None,foreground="#515056",state='normal')
            Text_ent1.place(relx=0.50,rely=0.415,width=200,height=50)
        
        # -------- Gift account fields view in authorisation pages and modify auth details  --------#
                    
            giftID = Select_data(dbpath, "SELECT * FROM tblinput_Giftaccount WHERE UniqID = '"+ UniqueID +"'")            
            Gift_list = ['Gift Transfer', 'Re-Materialisation', 'Amalgamation', 'Certificated Stock Deposits', 'CSN Transfers', 
                                     'Account Closure', 'Change of Data', 'Third Parties', 'POA/COP', 'CTF Account Locking', 'BACS']
                
            #if TransactionType == ["Gift Transfer"] or TransactionType == ["Re-Materialisation"] or TransactionType == ["Certificated Stock Deposits"] or TransactionType == ["CSN Transfers"] or TransactionType == ['Amalgamation']:
            if TransactionType[0] in Gift_list  and len(giftID)>0:
                #print(UniqueID)
                Label14.place(relx=0.03,rely=0.195)
                Label16.place(relx=0.50,rely=0.195)
                Cb6.place(relx=0.03,rely=0.25)
                Ent6.place(relx=0.50,rely=0.25,height=23)
                # if UniqueID == UniqueID:
                #     auth_check = "Inprocess"
                # else:
                #         auth_check = "Re-updated"   
                # -------- Authorisation gift account Reference No viewd  --------#            
                def Combo_selected8(e):
                    Referenceno = Cb6.get()
                    Ent6.delete(0,END)
                    giftuniq = UniqueID
                    record = [UniqueID, giftuniq, Referenceno]                                 
                    #query=("Select AuthScreen from tblinput_Giftaccount where UniqID =(?) and Reference = '" + str(dd)+"';")
                    query = "SELECT AuthScreen FROM tblinput_Giftaccount WHERE UniqID =? and GiftAccount IN (SELECT MIN(GiftAccount) FROM tblinput_Giftaccount WHERE UniqID = ? AND Reference = ? AND  AuthStatus = 'Inprocess' AND (Status = '' or Status = 'Re-update'))"
                    entry_list6 = View_query(dbpath, query,record)
                    Ent6.insert(0,entry_list6[0][0])   
                    print(entry_list6[0][0])
                            
                auth_check = "Inprocess"
                record = [UniqueID]            
                query = ("SELECT Reference FROM tblinput_Giftaccount WHERE UniqID =? and AuthStatus ='" + auth_check +"' ;")
                com_list8 = Viewtable_data(dbpath,query,record)              
                Cb6.config(values = com_list8)   
                # print([int(com_list8) for com_list8 in com_list8])
                # print(list(map(int, com_list8)))
                Cb6.bind("<<ComboboxSelected>>", Combo_selected8)
                                                                                                                                            
            else:
                Label14.place_forget()
                Cb6.place_forget()
                Label16.place_forget()
                Ent6.place_forget()
          
          
       
            
    #############################   Authorisation pages sumbit started   #############################     
    
    # -------- Re-update Production submit  --------#

        def Authorisation_Submit(UniqueID):                                                                       
            global NPHours   
            global active_page
            UserName = Inputuserid
            UniqID = UniqueID        
            TransactionAuth = Cb2.get()
            AccountNo = Ent2.get()
            Reference = Cb6.get()
            Pdate_format = date_ent1.get_date()
            ProcessDate = Pdate_format.strftime('%d-%m-%Y')
            AuthUserID =  getpass.getuser().lower()
            AuthScreen = Cb4.get()
            AuthStatus = Cb7.get()
            AuthStartTime = Reauth_starttime
            AuthEndTime =datetime.now().strftime('%d-%m-%Y %H:%M:%S')
            TransactionType = Cb2.get()
                            
            AuthN_Production = NPHours.strftime('%H:%M:%S')                                                  

        # -------- Gift account comments added in authorisation page --------#

            # if Cb7.get() =="Rejected" or Cb7.get() == "Re-update":
            #     AuthComments = Cb7.get()
            # elif Cb7.get() == "Others":
            AuthComments = Text_ent1.get(1.0,END).strip()

            if len(AuthStatus) == 0 :
                messagebox.showerror("Alert", "Kindly update required fields")
                return False
                            
        # -------- Authorisation submit & Giftaccount modify  --------#
            
            giftId = Select_data(dbpath, "SELECT * FROM tblinput_Giftaccount WHERE UniqID = '"+ UniqueID +"'") 
            Gift_list = ['Gift Transfer', 'Re-Materialisation', 'Amalgamation', 'Certificated Stock Deposits', 'CSN Transfers', 
                                     'Account Closure', 'Change of Data', 'Third Parties', 'POA/COP', 'CTF Account Locking', 'BACS']
            #print(len(giftId))
            #if TransactionType == "Gift Transfer" or TransactionType == "Re-Materialisation" or TransactionType == "Certificated Stock Deposits" or TransactionType == "CSN Transfers" or TransactionType == "Amalgamation":                                             
            if TransactionType in Gift_list:
                GiftAuthScreen = Ent6.get().strip()
                GiftReference = Cb6.get()
                if len(giftId) <=0:
                    if Cb7.get() == "Re-update Required" or Cb7.get() == "Rejected":
                        ipstauts  = "IP - Re-update Required"                        
                        Process_Status = Cb7.get()                
                        query =  """Update tblInput set Process_Status =? Where PrimaryID IN (Select max(PrimaryID) from tblInput where UniqueID = ?)"""
                        record = (Process_Status, UniqID)
                        Update_query(query, record)   
                        active_page = False                                        

                    elif Cb7.get() == "Autorised" or Cb7.get() == "Auto-Autorised":
                        ipstauts  = "Auth - Autorised"                              
                        query =  """Update tblInput set AuthStatus =? Where PrimaryID IN (Select max(PrimaryID) from tblInput where UniqueID = ?)"""
                        record = (Cb7.get(), UniqID)
                        Update_query(query,record)                        
                        active_page = False
                        
                elif len(GiftReference) == 0 or len(GiftAuthScreen) == 0 or len(giftId) ==0:
                    messagebox.showerror("Alert", "Kindly update required fields.")
                    return False
                else:
                     
                    AuthScreen = Ent6.get().strip()
                    Reference = Cb6.get()                       
                    if Cb7.get() == "Re-update Required" or Cb7.get() == "Rejected": 
                        ipstauts  = "IP - Re-update Required"
                        AuthStatus = "Inprocess" 
                        Process_Status  = Cb7.get() 
                        gift_status = "done"                     
                        # query = ("Update tblinput_Giftaccount set AuthScreen=?, AuthStatus=?, Status =? where UniqID =? and Reference =?;")
                        # record = (AuthScreen,'Inprocess', gift_status, UniqueID, Reference)
                        query = ("Update tblinput_Giftaccount set  AuthScreen =?, AuthStatus=?, Status =? Where UniqID =? and GiftAccount = (Select MIN(GiftAccount) from tblinput_Giftaccount WHERE UniqID = ? AND Reference = ? AND  AuthStatus = 'Inprocess' and (Status = '' or Status = 'Re-update'))")
                        record =(AuthScreen, AuthStatus, gift_status, UniqueID, UniqueID, Reference)
                        Update_query(query,record)  
                        
                        query =  """Update tblInput set Process_Status =? Where PrimaryID IN (Select max(PrimaryID) from tblInput where UniqueID = ?)"""
                        record = (Cb7.get(), UniqID)
                        Update_query(query,record) 
                                                                
                    # -------- Gift Transfer status check  --------#                

                        query =("select count(Status) from tblinput_Giftaccount where UniqID = ? and Status = '" + str(gift_status) + "';")
                        record = [UniqueID]   
                        giftcount = Viewtable_data(dbpath, query, record)
                        query =("select count(UniqID) from tblinput_Giftaccount where UniqID = ?;")
                        record = [UniqueID]   
                        uniqcount = Viewtable_data(dbpath, query, record)                             
                        if giftcount[0] == uniqcount[0]:                        
                            active_page = False
                        else:
                            active_page = ''
                            
                        #messagebox.showinfo("Alert", "Gift account modify")
                        
                    elif Cb7.get() == "Autorised" or Cb7.get() == "Auto-Autorised":
                        gift_status = "done"
                        # query = ("Update tblinput_Giftaccount set AuthScreen=?, AuthStatus =?, Status=? where UniqID =? and Reference =?;")                            
                        # record = (AuthScreen, AuthStatus, gift_status, UniqueID, Reference)
                        query = ("Update tblinput_Giftaccount set AuthScreen =?, AuthStatus =?, Status =? Where UniqID =? and GiftAccount = (Select MIN(GiftAccount) from tblinput_Giftaccount WHERE UniqID = ? AND Reference = ? AND  AuthStatus = 'Inprocess' and (Status = '' or Status = 'Re-update'))")
                        record =(AuthScreen, AuthStatus, gift_status, UniqueID, UniqueID, Reference)
                        Update_query(query,record)                                
                                                        
                        cont = 'Inprocess'
                        query =("select count(UniqID) from tblinput_Giftaccount where UniqID = ? and AuthStatus = '" + str(cont) + "';")
                        record = [UniqueID]                            
                        Auth_cunt = Viewtable_data(dbpath,query,record)                                                                                           
                        if Auth_cunt[0] != 0:   
                            #ipstauts  = "Auth - Assigned"
                            ipstauts  = "IP - Re-update Required"
                            active_page = ''  
                            query =("select count(Status) from tblinput_Giftaccount where UniqID = ? and Status = 'done';")
                            record = [UniqueID]   
                            giftcount = Viewtable_data(dbpath, query, record)
                            query =("select count(UniqID) from tblinput_Giftaccount where UniqID = ?;")
                            record = [UniqueID]   
                            uniqcount = Viewtable_data(dbpath, query, record)                    
                            if giftcount[0] == uniqcount[0]:                                                
                                active_page = False 
                        else:   
                            ipstauts  = "Auth - Autorised"              
                            query =  """Update tblInput set AuthStatus =? Where PrimaryID IN (Select max(PrimaryID) from tblInput where UniqueID = ?)"""
                            record = (Cb7.get(), UniqID)
                            Update_query(query,record)   
                            active_page = False                                                                           
                            #messagebox.showerror("match", "input data updated") 
                                                                                                                                        

            else:
                
                if Cb7.get() == "Re-update Required" or Cb7.get() == "Rejected":
                    ipstauts  = "IP - Re-update Required"
                    # query = ("Update tblInput set AuthStatus = ?, Auth_Comments=? Where UniqueID = ?;")
                    # record = (AuthStatus, AuthComments, UniqID)
                    # Update_query(query, record)
                    Process_Status = Cb7.get()                
                    query =  """Update tblInput set Process_Status =? Where PrimaryID IN (Select max(PrimaryID) from tblInput where UniqueID = ?)"""
                    record = (Process_Status, UniqID)
                    Update_query(query, record)   
                    active_page = False                    
                    

                elif Cb7.get() == "Autorised" or Cb7.get() == "Auto-Autorised":
                    ipstauts  = "Auth - Autorised"                              
                    query =  """Update tblInput set AuthStatus =? Where PrimaryID IN (Select max(PrimaryID) from tblInput where UniqueID = ?)"""
                    record = (Cb7.get(), UniqID)
                    Update_query(query,record)
                    
                    active_page = False  
                    # Process_Status = Cb7.get()
                    # query = ("Update tblInput set Process_Status = ?Where UniqueID = ?;")
                    # record = (Process_Status, UniqID)
                    # Update_query(query,record)   
                    # uniq_stauts = "Completed"                                                                     
                    # record = (uniq_stauts, UniqueID)
                    # query = ("Update tblInput set AuthStatus = ? Where UniqueID = ?;")                            
                    # Update_query(query,record)
                    # messagebox.showinfo("Alert", "Gift account status modify")

            query = ("Insert INTO tblAuthorisation (UniqID, UserName, TransactionAuth, AccountNo, Reference, ProcessDate, AuthUserID, AuthScreen, AuthStatus, AuthComments, AuthStartTime, AuthEndTime, AuthNProduction, Authdate) Values (?,?,?,?,?,?,?,?,?,?,?,?,?,?);")
            record = (UniqID, UserName, TransactionAuth, AccountNo, Reference, ProcessDate, AuthUserID, AuthScreen, AuthStatus, AuthComments, AuthStartTime, AuthEndTime, AuthN_Production, datetime.now().strftime('%d-%m-%Y'))
            import_data(dbpath,query,record)                
            
            # -------- Gift Transfer Referrence column update   --------#
            # auth_check = "Inprocess"
            # Referenceno = Cb6.get()
            # Ent6.delete(0,END)        
            # record = [UniqueID, UniqueID, Referenceno] 
            record = [UniqueID]            
            query = ("SELECT Reference FROM tblinput_Giftaccount WHERE UniqID =? and AuthStatus ='Inprocess' and (Status = '' or Status = 'Re-update') ;")
            #query = ("SELECT Reference FROM tblinput_Giftaccount WHERE UniqID =? and GiftAccount IN (SELECT MIN(GiftAccount) FROM tblinput_Giftaccount WHERE UniqID = ? AND AuthStatus ='Inprocess' and (Status = '' or Status = 'Re-update')) ;")
            #query = "SELECT AuthScreen FROM tblinput_Giftaccount WHERE UniqID =? and GiftAccount IN (SELECT MIN(GiftAccount) FROM tblinput_Giftaccount WHERE UniqID = ? AND Reference = ? AND  AuthStatus = 'Inprocess')"
            com_list8 = Viewtable_data(dbpath,query,record)              
            Cb6.config(values = com_list8)        
            
            # -------- Reupdated status modify in Main table  --------#
            if var_2.get() == 0:
                Authorisation="No"                       
            else:
                Authorisation="Yes"
                
            InputUserID = UserID     
            AuthoriserID = AuthUserID             
            CurrentStatus = ipstauts             
            query = ("Update tblMain set InputUserID = ?, AuthoriserID =?, Authorisation =?, CurrentStatus =? Where UniqueID = ?;")
            record = (InputUserID, AuthoriserID, Authorisation, CurrentStatus, UniqueID)
            Update_query(query,record) 
            
            if active_page == False:            
                NPHours = datetime.min                                          
                Work_Queue(stframe)       
                return False
                    
            elif active_page == '':
                Ent6.delete(0, END)
                Cb6.delete(0, END)
                Cb7.delete(0, END)
                Text_ent1.delete(1.0, END)
                NPHours = datetime.min         
                                        

        # if Sourcename == "Authorisation":        
        #     Inputrework(UniqueID)
        
    # -------- Re-update Production submit  --------#
        
                     
        def Reupdate_Psubmit():
            
            global NPHours    
            global active_page
            
            InputUserID = StringVar()
            AuthoriserID = StringVar()
            CurrentStatus = StringVar()           
                                                                                                                                                        
            # -------- Find & updated the uniqID in Input page   --------#
            # query = ("Select UniqueID from tblInput where InputID =?")
            # inputuniq = Viewtable_data (dbpath,query,record)                                                                                                                      
            # UniqueID = str(inputuniq[0])                
                                                        
            ProcessDate = datetime.now().strftime('%d-%m-%Y')
            UserID= user_name
            ModeofRequest = Cb1.get()

            if var_1.get() == 0:
                CL="No"            
            else:
                CL = "Yes"
                AccountNumber = 1

            CC= CL
            TransactionType = Cb2.get()
            CaseReference= Ent1.get().strip()
            AccountNumber = Ent2.get().strip()
            NoofItems = Ent3.get().strip()       
            
            if var_2.get() == 0:
                auth="No"
                #ipstauts = "IP - "
                
            else:
                auth="Yes"
                #ipstauts = "Auth - "

            Authorisation= auth
            AuthorisationScreen = Cb4.get()        
            Status = Cb5.get()
            StartTime = Reinput_starttime        
            EndTime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')        
            
            Break_Hrs = NPHours.strftime('%H:%M:%S')
            Comments=Ent4.get(1.0,END).strip()       
            Giftlist = ['Gift Transfer', 'Re-Materialisation', 'Amalgamation', 'Certificated Stock Deposits', 'CSN Transfers', 'Account Closure', 'Change of Data', 'Third Parties', 'POA/COP', 'CTF Account Locking', 'BACS']    

            # -------- Re-Input status validation process --------# 
            if len(ModeofRequest) == 0 or len(TransactionType) == 0:
                messagebox.showwarning("Warning","Kindly update the required fields!")
                return False    
            
            elif TransactionType == 'Section 793':
                if len(CaseReference) ==0 or len(Status)==0 :
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False            
            
            elif TransactionType == 'Allocate Transactions':
                if len(Status)==0 :
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False
            
            elif var_1.get() == 1:
                if len(ModeofRequest) == 0 or len(TransactionType) ==0 or len(CaseReference) ==0:
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False                                      
                
            elif var_2.get() == 1 and TransactionType not in Giftlist :
                if len(AuthorisationScreen) == 0 or len(NoofItems) ==0 or len(Status)==0 or len(AccountNumber) ==0 :
                    messagebox.showwarning("Warning","Kindly update the required fields!")
                    return False                                    
            
            elif len(ModeofRequest) == 0 or len(TransactionType) == 0 or len(AccountNumber) == 0 or len(NoofItems) ==0 or len(Status)== 0:
                messagebox.showwarning("Warning","Kindly update the required fields!")
                return False 
            

            # -------- Get the Input status --------#   
            record = UniqueID
            query = ("Select AuthStatus from tblInput where UniqueID =?")
            auth_status = Viewtable_data (dbpath,query,record)                          
                            

            #-------- Gift account authorisation status checking --------#
            if   Giftvalidation == "GIFT TRANSFER" and auth == 'Yes' and  TransactionType in Giftlist :  
                cont = 'Inprocess'
                record = UniqueID
                query =("select count(UniqID) from tblinput_Giftaccount where UniqID = ? and AuthStatus = '" + str(cont) + "' AND (Status = '' or Status = 'done');")
                Auth_cunt = Viewtable_data(dbpath,query,record)    
                # print(Auth_cunt)
                if Auth_cunt != [0]:
                    messagebox.showinfo("Alert","Kindly update the Gift Transfer fields!")
                    return False
                
                if Auth_cunt[0] != 0 and auth_status ==  ['Re-update Required']:
                                    
                    Process_Status = "Unassigned"
                    AuthStatus = "Re-update Done"
                    query = ("Update tblInput set AuthStatus = ? Where UniqueID = ?;")
                    record = ("InProcess", UniqueID)
                    Update_query(query,record)                                                                               
            
            # -------- Authorisation fields add & update in input database  --------#
            
            elif auth == 'Yes' and  TransactionType in Giftlist :
                entry_val1 = Ent9.get()
                
                if len(entry_val1) == 0:
                    messagebox.showerror("Alert", 'Please update the Gift Transfer count.')  
                    Cb2.focus_force()
                    can3.focus_set()                                        
                    can3.place(relx=0.450,rely=0.08,width=450)        
                    # gtentry = entry_val1
                    return False
                                            
            #-------- Gift account fields check and reupdated --------#            
                for rw in range(int(entry_val1)):                
                    Reference = gift_entry[rw].get()
                    AuthScreen = gift_combo[rw].get()
                    
                    if len(Reference) == 0 or len(AuthScreen) == 0:                    
                        messagebox.showerror("Alert", "Kindly update the Gift Transfer fields!")
                        #gcrosscheck = 0
                        return False

                i =0
                                

                for rw in range(int(entry_val1)):                                        
                    
                    Reference = gift_entry[rw].get()
                    AuthScreen = gift_combo[rw].get()
                    GiftAuthStatus = 'Inprocess'   
                    GiftStatus  =''            
                                    
                    if AuthScreen == 'BOTH':
                        i= i + 1
                        Giftaccount = i  

                        if Cb2.get() == "Certificated Stock Deposits" or Cb2.get() == "CSN Transfers" :
                            AuthScreen = "CSD"
                        elif Cb2.get() == "Gift Transfer" or Cb2.get() == "Re-Materialisation" :
                            AuthScreen = "OAT"
                        elif Cb2.get() =="Amalgamation":
                            AuthScreen = "DESM"

                        Reference = gift_entry[rw].get() 
                        Insert_column = "INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?);"
                        Insert_hd = [UniqueID[0], Giftaccount, Reference, AuthScreen, GiftAuthStatus, GiftStatus]
                        import_data(dbpath,Insert_column,Insert_hd)
                        i = i + 1                        
                        Giftaccount = i 

                        if Cb2.get() == "Certificated Stock Deposits" or Cb2.get() == "CSN Transfers" :
                            AuthScreen = "CSN"
                        elif Cb2.get() == "Gift Transfer" or Cb2.get() == "Re-Materialisation" or Cb2.get() =="Amalgamation":
                            AuthScreen = "DESM"

                        Reference = gift_entry[rw].get() 
                        Insert_column = "INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?);"
                        Insert_hd = [UniqueID[0], Giftaccount, Reference, AuthScreen, GiftAuthStatus, GiftStatus]
                        import_data(dbpath,Insert_column,Insert_hd)
                        #messagebox.showerror("Alert", "gift account updated!")
                    else:
                        i = i + 1
                        Giftaccount = i 
                        Insert_column = "INSERT INTO tblinput_Giftaccount (UniqID, GiftAccount, Reference, AuthScreen, AuthStatus, Status) VALUES (?,?,?,?,?,?);"
                        Insert_hd = [UniqueID[0], Giftaccount, Reference, AuthScreen, GiftAuthStatus, GiftStatus]
                        import_data(dbpath,Insert_column,Insert_hd)
                                        
            # -------- update the process status & input status --------# 

            if auth_status == ['Re-update Required'] and Cb5.get() == "Completed":
                Process_Status = "Unassigned"
                #AuthStatus = "InProcess"
                AuthStatus = "Re-update Done"                         
                query = ("Update tblInput set AuthStatus = ? Where UniqueID = ?;")
                record = ("InProcess", UniqueID)
                Update_query(query,record)
            elif auth == "Yes" and Status == "In Process":
                Process_Status = "In Process"
                AuthStatus = "In Process"
                ipstauts = "IP - In Process"
            elif auth == "Yes" and Status == "Completed":
                Process_Status = Status
                AuthStatus = "In Process"     
                ipstauts = "Auth - Unassigned"               
            elif Cb5.get() == "Completed":
                AuthStatus = "Re-update Done" 
                Process_Status = "Re-update Done" 
                ipstauts = "IP - Completed"
            elif Status == "In Process":
                Process_Status = Cb5.get()
                AuthStatus = "In Process"
                ipstauts = "IP - In Process"
            else:
                AuthStatus = "In Process"
                Process_Status = Cb5.get()
                ipstauts = "IP - " + Status
                
                    
            Insert_column = "INSERT INTO tblInput (UniqueID, ProcessDate, UserID, ModeofRequest, CC, TransactionType, CaseReference, AccountNumber, NoofItems, Authorisation, AuthorisationScreen, Status, Comments, StartTime, EndTime, Break_Hrs, AuthStatus, Process_Status) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);"
            Insert_hd = [UniqueID[0], ProcessDate, UserID, ModeofRequest, CC, TransactionType, CaseReference, AccountNumber, NoofItems, Authorisation, AuthorisationScreen, Status, Comments, StartTime, EndTime, Break_Hrs, AuthStatus, Process_Status]
            import_data(dbpath,Insert_column,Insert_hd)                    

            # -------- Reupdated status modify in Main table  --------#

            InputUserID = UserID     
            AuthoriserID = ''               
            CurrentStatus = ipstauts
            query = ("Update tblMain set InputUserID = ?, AuthoriserID =?, Authorisation =?, CurrentStatus =? Where UniqueID = ?;")
            record = (InputUserID, AuthoriserID, Authorisation, CurrentStatus, UniqueID[0])
            Update_query(query,record)                    

            NPHours = datetime.min
            Cb1.delete(0,END)
            Cb2.delete(0,END)
            Cb2.config(state='disable')
            Ent1.delete(0,END)
            Ent2.delete(0,END)
            Cb4.delete(0,END)
            Cb5.delete(0,END)
            Check2.deselect()
            Check1.deselect()
            Ent4.delete(1.0,END)
            Cb11.delete(0,END)        
            active_page = False  
            Work_Queue(stframe) 
            
            
    


        # But10 = Button(can1,text="Submit", width=12,height=0,bg="#00728F",foreground="black", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=Reupdate_Psubmit)
        # But10 = Button(can1,text="Submit", width=12,height=0,bg="skyblue",foreground="black", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=Reupdate_Psubmit)
        # But10.place(relx=0.32,rely=0.90)

        #############################   Input and Authorisation Reupdate pages Submit End #############################  










        
    ############################################## Non - Production #############################################

    global running, hours, minutes, seconds,NPHours
    running = False
    hours, minutes, seconds = 0, 0, 0
    NPHours = datetime.min


    #-------- Clock Timing --------#

    def ClockRun(Clockroot):

        ClockRun.stopwatch_label = Label(Clockroot,text='00:00:00', bg="white", font=('Calibri', 15, 'bold'))
        ClockRun.stopwatch_label.place(x=280,y=10)

        def start(stopwatch_label, Initial):
            global running
            if not running:
                update(stopwatch_label)
                running = True

        def update(stopwatch_label):
            global hours, minutes, seconds
            seconds += 1
            if seconds == 60:
                minutes += 1
                seconds = 0
            if minutes == 60:
                hours += 1
                minutes = 0

            hours_string = f'{hours}' if hours > 9 else f'0{hours}'
            minutes_string = f'{minutes}' if minutes > 9 else f'0{minutes}'
            seconds_string = f'{seconds}' if seconds > 9 else f'0{seconds}'

            stopwatch_label.config(text=hours_string + ':' + minutes_string + ':' + seconds_string)

            global update_time
            update_time = stopwatch_label.after(1000, lambda:update(stopwatch_label))

        start(ClockRun.stopwatch_label, 'Yes')

    #-------- Non - Proudction pages --------#

    def Non_Production_hrs():
        global But6, But7
        # But6.configure(background ='sky blue')
        # But7.configure(background ='#00728F')
        NPStartTime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')
        
        def avoid():
            MsgAnswer = messagebox.askyesno("Exit Non Production", "Are you sure want to close without submitting Non Production details?")
            if MsgAnswer ==True:
                global hours, minutes, seconds
                hours, minutes, seconds = 0, 0, 0
                global running
                running = False
                But6.configure(background ='#00728F')
                branch_w.destroy()

        def NonP_Submit():
            global CB_list
            global CB_S_list

            NPBreakItem = Cb_Break.get()
            NPActivity = CB_Activity.get()
            NPTransactionName = CB_S_Activity.get()
            NPComments = E_Comment.get(1.0,END).strip()
            NPEntryBY = user_name


            if len(CB_list) > 0 and len(CB_S_list) > 0:
                Condition = NPBreakItem == '' or NPActivity == '' or NPTransactionName == ''
            elif len(CB_list) == 0 and len(CB_S_list) > 0:
                Condition = NPBreakItem == '' or NPTransactionName == ''
            elif len(CB_list) > 0 and len(CB_S_list) == 0:
                Condition = NPBreakItem == '' or NPActivity == ''
            elif len(CB_list) == 0 and len(CB_S_list) == 0:
                Condition = NPBreakItem == ''

            if Condition:
                messagebox.showerror("Validation","Mandatory fields should not be left blank!")
            else:

                global hours, minutes, seconds
                hours, minutes, seconds = 0, 0, 0

                global NPHours
                NpDate = datetime.now().strftime('%d-%m-%Y')
                NPEndTime = datetime.now().strftime('%d-%m-%Y %H:%M:%S')
                
                global running
                running = False
                # print('NPHours - before submit ' + str(NPHours))
                NPHours = NPHours + (datetime.strptime(NPEndTime, '%d-%m-%Y %H:%M:%S') - datetime.strptime(NPStartTime, '%d-%m-%Y %H:%M:%S'))
                #NP_hrs = NPHours.strftime('%H:%M:%S')
                NP_hrs = datetime.strptime(NPEndTime, '%d-%m-%Y %H:%M:%S') - datetime.strptime(NPStartTime, '%d-%m-%Y %H:%M:%S')
                #print(Np_hrs.strftime('%H:%M:%S'))
                NP_hrs = str(NP_hrs)
                query = ("INSERT INTO tblhalt_NonP_Hrs (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, NPHours) Values (?,?,?,?,?,?,?,?,?);")
                record = (NpDate, NPBreakItem, NPActivity, NPTransactionName, NPComments, NPEntryBY, NPStartTime, NPEndTime, str(0)+NP_hrs)
                import_data(dbpath,query,record)
                branch_w.destroy()
                messagebox.showinfo("Submitted","Non Production Details Submitted Successfully!")
                But6.configure(background ='#00728F')

        branch_w= Toplevel(ismaint)
        branch_w.geometry("400x400+725+350")
        branch_w.resizable(0,0)
        branch_w.title("IS_Maintanance - Non Production")
        branch_w.config(bg='White')
        branch_w.iconbitmap(icon_im)

        ClockRun(branch_w)
        branch_w.grab_set()
        branch_w.protocol('WM_DELETE_WINDOW',avoid)

        def Transaction_Select(event):
            global CB_S_list
            Label1_Activity.place_forget()
            CB_S_Activity.set('')
            CB_S_Activity.place_forget()

            record =[CB_Activity.get()]
            query = ("SELECT TransactionName FROM tblhald_Transaction WHERE ActivityID = (SELECT ActivityID FROM tblhaltActivity WHERE Activity =(?));")
            CB_S_list = Viewtable_data(dbpath, query, record)
            #print(CB_S_list)


            if CB_Activity.get() =="" or len(CB_S_list) ==0:
                Label1_Activity.place_forget()
                CB_S_Activity.set('')
                CB_S_Activity.place_forget()
                CB_S_list =[]

            else:
                Label1_Activity.place(x=15,y=165)
                CB_S_Activity.set('')
                CB_S_Activity.place(x=15,y=195)
                CB_S_Activity.config(completevalues=CB_S_list)
                #CB_S_Activity.bind("<<ComboBOdSelected>>", Transaction_Select)

        def breakactivity_select(event):
            global CB_list
            global CB_S_list
            Label_Acivity.place_forget()
            CB_Activity.set('')
            CB_Activity.place_forget()
            
            Label1_Activity.place_forget()
            CB_S_Activity.set('')
            CB_S_Activity.place_forget()

            record =[Cb_Break.get()]
            query = ("SELECT Activity FROM tblhaltActivity WHERE BreakID = (SELECT BreakID FROM tblhalt WHERE BreakItems =(?));")
            CB_list = Viewtable_data(dbpath, query, record)
            
            if Cb_Break.get() =="" or len(CB_list) ==0:
                Label_Acivity.place_forget()
                CB_Activity.set('')
                CB_Activity.place_forget()
                Label1_Activity.place_forget()
                CB_S_Activity.set('')
                CB_S_Activity.place_forget()

                CB_list=[]
                CB_S_list = []

            else:
                Label_Acivity.place(x=15,y=95)
                CB_Activity.set('')
                CB_Activity.place(x=15,y=125)
                CB_Activity.config(completevalues=CB_list)
                CB_Activity.bind("<<ComboboxSelected>>", Transaction_Select)
                CB_Activity.bind("<FocusOut>",Transaction_Select)


        global CB_list
        global CB_S_list
        L_Reason=Label(branch_w,text="Reason",font=('Calibri (Body)',12,'bold'),bg='white')
        L_Reason.place(x=15,y=25)
        query=Select_data(dbpath, "select BreakItems from tblhalt;")
        break_activity = query
        #Break_Reasons=Combodrop(Condition)
        Cb_Break=AutocompleteCombobox(branch_w,font=('Calibri',13) ,width=38,completevalues=break_activity,state='readonly')
        Cb_Break.place(x=15,y=55)
        Cb_Break.bind("<<ComboboxSelected>>", breakactivity_select)
        Cb_Break.bind("<FocusOut>", breakactivity_select)
        Label_Acivity=Label(branch_w,text="Activity",font=('Calibri (Body)',12,'bold'),bg='white')
        #Label_Acivity.place(x=15,y=95)

        CB_list=[]
        CB_Activity=AutocompleteCombobox(branch_w,font=('Calibri',13),state="readonly",width=38,completevalues=CB_list)
        #CB_Activity.place(x=15,y=125)


        Label1_Activity=Label(branch_w,text="Sub Activity",font=('Calibri (Body)',12,'bold'),bg='white')
        #Label1_Activity.place(x=15,y=165)
        CB_S_list=[]
        CB_S_Activity=AutocompleteCombobox(branch_w,font=('Calibri',13),state="readonly",width=38,completevalues=CB_S_list)
        #CB_S_Activity.place(x=15,y=195)

        L_Comment=Label(branch_w,text="Comments",font=('Calibri (Body)',12,'bold'),bg='white')
        L_Comment.place(x=25,y=230)

        E_Comment=Text(branch_w,font=('Calibri',13,'bold'),width=35,height=3,bd=3,highlightthickness=0)
        E_Comment.place(x=25,y=255)

        BT_Mainwin=Button(branch_w,text='Submit',command=NonP_Submit,bg="#00728F",fg='white',font=("Calibri",12,'bold'),borderwidth=3, width=10)
        BT_Mainwin.place(x=150,y=340)

    ######################################################################### End of Non Production ########################################



    ######################################################################### Quality page start  ########################################

    def Qualitypage_check(stframe): 
        global active_page       
        if active_page == True:                    
            output = messagebox.askquestion("Job not created", 'Are you sure you want to exit without submitting?')
            
            if output == "yes":
                active_page = False
                Ism_Quality(stframe)
        elif active_page == False:
            Ism_Quality(stframe)


    ######################################################################### IS_M Quality ########################################

    def Ism_Quality(stframe):
        global NPHours
        global active_page
        active_page = True 
        
        But1.config(bg ="#00728F")
        But2.config(bg ='#00728F')
        But4.configure(background ='Sky blue')
        
        NPHours =datetime.min
        #messagebox.showinfo('Under Development', 'Quality is under Development')
        #Quality_Button.config(state='disabled',bg="#98d4e3",font=("Calibri", 11,"bold"),cursor="hand2")    
        Can8 = Canvas(stframe,bg="white", height=515,width=1178,highlightthickness=0)
        Can8.place(relx=0.00,rely=0.11)  
        TimerLabel = Label(Can8, text="Timer: " + "00:00:00",width=15,height=1,fg="#054457", bg="white",font=("Calibri (Body)",11,"bold"))
        TimerLabel.place(relx=0.88, rely=0.001)
        Timer1=TimerRun(TimerLabel)  
        QcStartDate = datetime.now().strftime('%d-%m-%Y %H:%M:%S')
        #---Process Date-----------------------------------------------------------------------------------------------------------------------------
        QC_Label25=Label(Can8,text="WIT Processed Date",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label25.place(relx=0.03,rely=0.10)    
        
        # date_ent1 = DateEntry(can2, background= "black", foreground= "white",bd=0,font=('Calibri',11), date_pattern='dd/mm/yyyy')
        # date_ent1.set_date(Auth_date)
        # date_ent1.place(relx=0.03,rely=0.08, width=178, height=23)
        today = dt.datetime.today()
        QC_T_WIT_Date=DateEntry(Can8, background= "black", foreground= "white",bd=0,font=('Calibri',12),date_pattern='dd-mm-yyyy', maxdate =  date.today())
        QC_T_WIT_Date.place(relx=0.03,rely=0.15, width=180, height=24)
        
        offset = max(1, (today.weekday() + 6) % 7 - 3)
        timedelta = dt.timedelta(offset)
        most_recent = today - timedelta
        P_Date=most_recent.strftime('%d-%m-%Y')    
        QC_T_WIT_Date._set_text(P_Date)
        
            
        # -------- Team Name List  --------#
        
        def QCTransactions(event):
            QC_Cb9.delete(0, END)
            # query = ("SELECT * FROM tblProcess_data2 WHERE Modetype =? ")            
            # Qc_transction = View_query(dbpath, query, record)
            
            query = ("Select * From tblProcess_data2 WHERE Modetype =? ")
            record = [QC_Cb8.get()]
            rows = View_query(dbpath, query,record)
            Qc_transction = []
            for rw in rows:
                Qc_transction.append(rw[1])
            
            QC_Cb9.config(completevalues = Qc_transction)
            # print(Qc_transction)
            
            if len(QC_Cb8.get())>0:
                if QC_Cb8.get() not in Qc_Teamname:
                    messagebox.showerror("Incorrect Channel", "Kindly Select Valid Request Channel")
                    QC_Cb8.focus_set()                
                    QC_Cb8.delete(0, END)
                else:
                    pass
                
        def Transactions_check(event):
            query = ("Select * From tblProcess_data2 WHERE Modetype =? ")
            record = [QC_Cb8.get()]
            rows = View_query(dbpath, query,record)
            Qc_transction = []
            for rw in rows:
                Qc_transction.append(rw[1])
            
            if len(QC_Cb9.get())>0:
                if QC_Cb9.get() not in Qc_transction:
                    messagebox.showerror("Incorrect Transactions", "Kindly Select Valid Transactions")
                    QC_Cb9.focus_set()                
                    QC_Cb9.delete(0, END)
                else:
                    pass
            
        query = ("SELECT Distinct(Modetype) FROM tblProcess_data2")
        Qc_Teamname = Select_data(dbpath, query)
        QC_Label26 = Label(Can8,text="Request Channel",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label26.place(relx=0.28,rely=0.10)
        QC_Cb8 = AutocompleteCombobox(Can8, font=("Calibri",12),foreground="#515056",completevalues=Qc_Teamname)
        QC_Cb8.place(relx=0.28,rely=0.15, width=180, height=24)
        QC_Cb8.bind("<<ComboboxSelected>>", QCTransactions)
        QC_Cb8.bind("<FocusOut>", QCTransactions)
        
        #---Team Name--------------------------------------------------------------------------------------------------------------------------
        QC_Label27 = Label(Can8,text="Transactions",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label27.place(relx=0.53,rely=0.10)
        Qc_transction = []
        QC_Cb9 = AutocompleteCombobox(Can8 ,font=("Calibri",12),foreground="#515056", completevalues=Qc_transction)
        QC_Cb9.place(relx=0.53,rely=0.15, width=180, height=24)
        #QC_Cb9.config(values = Qc_transction)
        QC_Cb9.bind("<<ComboboxSelected>>",Transactions_check)
        QC_Cb9.bind("<FocusOut>",Transactions_check)

        #---Sub_Team Name--------------------------------------------------------------------------------------------------------------------------
        QC_Label28 = Label(Can8,text="Account No",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label28.place(relx=0.78,rely=0.10)
        QC_Ent10 = Entry(Can8, width=25, bg="white", font=("Calibri",12),highlightbackground=None,highlightcolor=None, foreground="#515056")
        QC_Ent10.place(relx=0.78,rely=0.15,width=180, height=24)
            
        QC_Label29 = Label(Can8,text="WIT Number/UMI",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label29.place(relx=0.03,rely=0.28)
        QC_Ent11 = Entry(Can8, width=25, bg="white",font=("Calibri",12),highlightbackground=None,highlightcolor=None, foreground="#515056")
        QC_Ent11.place(relx=0.03,rely=0.33, width=180, height=24)
        
        #---QC Count Name--------------------------------------------------------------------------------------------------------------------------
        # QC_Ent12 = Entry(Can8,font=("Calibri",11,"bold"),foreground="#515056",justify='center',bg="#E0E3E5")
        # QC_Ent12.place(relx=0.15,rely=0.28,width=35)
        # QC_Ent12.insert(0,1)

        # #---User Name & ID---------------------------------------------------------------------------------------------------------------------------
        
        Conn = sqlite3.connect(Supportdb)
        c = Conn.cursor()
        c.execute("SELECT * FROM TblUser_data")    
        Qc_userlist = c.fetchall()
        QClist = []
        
        for i in Qc_userlist:        
            QClist.append(i[0]+"-"+i[1])
        Conn.close()
                
        def Qcusername_check(event):
            if len(QC_Cb10.get())>0:
                if QC_Cb10.get() not in QClist:
                    messagebox.showerror("Incorrect User ID", "Enter valid User ID")
                    QC_Cb10.focus_set()                
                    QC_Cb10.delete(0, END)
                else:
                    pass
        
        QC_Label30 = Label(Can8,text="User ID",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label30.place(relx=0.28,rely=0.28)
        #U_List.remove(UserID+'-'+U_Name)
        QC_Cb10 = AutocompleteCombobox(Can8 ,font=("Calibri",12),completevalues= QClist,foreground="#515056")
        QC_Cb10.place(relx=0.28,rely=0.33,width=180, height=24)
        QC_Cb10.bind("<<ComboboxSelected>>",Qcusername_check)
        QC_Cb10.bind("<FocusOut>",Qcusername_check)

        #---Skill Level---------------------------------------------------------------------------------------------------------------------
        query = ("Select * from TblSkillLevel")
        S_Level=Select_data(Supportdb, query)
        Skill_Level = []
        # for i in S_Level:
        #     Skill_Level.append(i[0])
        
        def QC_Skillcheck(event):   
            if len(QC_Cb11.get())>0:
                if QC_Cb11.get() not in S_Level:
                    messagebox.showerror("Incorrect Skill Level", "Enter valid Skill Level")
                    QC_Cb11.focus_set()
                    QC_Cb11.delete(0, END)
                else:
                    pass
        QC_Label31 = Label(Can8,text="Skill Level",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label31.place(relx=0.53,rely=0.28)
        QC_Cb11 = AutocompleteCombobox(Can8 ,font=("Calibri",12),foreground="#515056",completevalues=S_Level)
        QC_Cb11.place(relx=0.53,rely=0.33,width=180, height=24)
        QC_Cb11.bind("<<ComboboxSelected>>",QC_Skillcheck)
        QC_Cb11.bind("<FocusOut>",QC_Skillcheck)

        # #---Value---------------------------------------------------------------------------------------------------------------------------
        QC_Label32 = Label(Can8,text="Value",fg="#f2f2f9",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label32.place(relx=0.78,rely=0.28)
        QC_Ent13 = Entry(Can8, width=25, bg="white",font=("Calibri",12),highlightbackground=None,highlightcolor=None, foreground="#f2f2f9", state='disabled')
        QC_Ent13.place(relx=0.78,rely=0.33, width=180, height=24)
        QC_Ent13.insert(0,'0.0')
        
        # #---Currency---------------------------------------------------------------------------------------------------------------------------
        Currency=['$','','']
        QC_Cb12 = AutocompleteCombobox(Can8 ,font=("Calibri",12),foreground="#f2f2f9",completevalues=Currency,state='disabled')    
        QC_Cb12.place(relx=0.90,rely=0.28, width=35)
        QC_Cb12.config(state='normal')
        QC_Cb12.insert(0,'')
        QC_Cb12.config(state='disabled')
        
        #---Completed Status---------------------------------------------------------------------------------------------------------------------
        def Qc_SkillCheck(event):        
            
            if len(QC_Cb13.get())>0:
                C_Status=['Yes','No','Advisory']
                if QC_Cb13.get() not in C_Status:
                    messagebox.showerror("ALERT", "Enter valid Error Status")
                    QC_Cb13.focus_set()
                    QC_Cb13.delete(0, END)
                else:
                    pass

            if QC_Cb13.get()=="No" :
                QC_Cb14.config(state='Normal')
                query = ("SELECT * FROM TblErrorCode WHERE Sub_Team_Name = ?")
                record=["IS Maintenance"]
                rows=View_query(Supportdb,query,record)            
                result = []
                for i in rows:
                    result.append(i[2])
                    
                QC_Cb14.delete(0, END)
                QC_Cb14.config(completevalues=result)
            else:
                QC_Cb14.config(state='normal')
                QC_Cb14.delete(0, END)
                QC_Cb14.config(state='disabled')
                QC_Text2.config(state='normal')
                QC_Text2.delete(1.0, END)
                QC_Text2.config(state='disabled')
                QC_Text3.config(state='normal')
                QC_Text3.delete(1.0, END)
                QC_Text3.config(state='disabled') 
            
            if QC_Cb13.get()=="Advisory" or QC_Cb13.get()=="No":
                QC_Text4.config(state='normal',bg ='white')
            else:
                QC_Text4.config(state='normal')
                QC_Text4.delete(1.0, END)
                QC_Text4.config(state='disabled',bg='#f2f2f2')
            
        QC_Label33 = Label(Can8,text="Completed Correctly?",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label33.place(relx=0.03,rely=0.46)
        C_Status=['Yes','No','Advisory']
        QC_Cb13 = AutocompleteCombobox(Can8 ,font=("Calibri",12),completevalues=C_Status,foreground="#515056")
        QC_Cb13.place(relx=0.03,rely=0.51, width=180, height=24)
        QC_Cb13.insert(0, 'Yes')
        QC_Cb13.bind('<FocusOut>',Qc_SkillCheck)
        QC_Cb13.bind('<<ComboboxSelected>>',Qc_SkillCheck)

        #---Error Code---------------------------------------------------------------------------------------------------------------------
        def QC_ECodecheck(event): 
            
            query= ("SELECT Error_Code FROM TblErrorCode WHERE Sub_Team_Name = (?)")
            record=["IS Maintenance"]
            rows= View_query(Supportdb,query,record)
            result3=[]
            for i in rows:
                    result3.append(i[0])
                
            if len(QC_Cb14.get())>0:
                if QC_Cb14.get() not in result3:
                    messagebox.showerror("Incorrect Error Code", "Enter valid Error Code")
                    QC_Cb14.focus_set()
                    QC_Cb14.delete(0, END)
                else:
                    pass

            ErrorCode=QC_Cb14.get()
            query =("SELECT * FROM TblErrorCode WHERE Sub_Team_Name = (?) and Error_Code = (?) ")
            record=["IS Maintenance", ErrorCode]
            rows=View_query(Supportdb,query,record)
            for row in rows:
                E_Des=row[3]
                E_Risk=row[4]
                QC_Text2.config(state='normal')
                QC_Text2.delete(1.0, END)
                QC_Text2.insert(END,E_Des)
                QC_Text2.config(state='disabled')
                QC_Text3.config(state='normal')
                QC_Text3.delete(1.0, END)
                QC_Text3.insert(END,E_Risk)
                QC_Text3.config(state='disabled')
        
        # def Error_Report(event):
        #     conn = sqlite3.connect(Data_Base_Support)
        #     query1 = "SELECT * FROM TblErrorCode"
        #     queries = [query1]
                
        #     for q in queries:
        #         df = pd.read_sql_query(q, conn)
        #     conn.close()
        #     messagebox.showinfo('Completed','Error Report Created!')
            
        #     xw.view(df, table=False)
            
        QC_Label34 = Label(Can8,text="Error Code",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"),cursor="hand2")
        QC_Label34.place(relx=0.28,rely=0.46)
        QC_Cb14 = AutocompleteCombobox(Can8 ,font=("Calibri",12),foreground="#515056",state='disabled')
        QC_Cb14.place(relx=0.28,rely=0.51, width=180, height=24)
        QC_Cb14.bind('<FocusOut>',QC_ECodecheck)
        QC_Cb14.bind('<<ComboboxSelected>>',QC_ECodecheck)
        # QC_L_ErrorCode.bind("<Double-Button>",Error_Report)
        

        # #---Error Code Des---------------------------------------------------------------------------------------------------------------------
        QC_Label35 = Label(Can8,text="Error Description",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label35.place(relx=0.53,rely=0.46)    
        
        QC_Text2 = Text(Can8, width=23, bg="#f2f2f2",font=("Calibri",12),highlightbackground=None,highlightcolor=None,foreground="#515056" ,state='disabled',wrap="word")
        QC_Text2.place(relx=0.53,rely=0.51, width=180, height=24)
        QC_Text2.bind('<Tab>', lambda event: focusNext(QC_Text2))
        QC_Text2.bind('<Shift-Tab>', lambda event: focusPrev(QC_Text2))
        
        #---Error Code  Risk Level---------------------------------------------------------------------------------------------------------------------------
        QC_Label36 = Label(Can8,text="Error Risk Rating",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label36.place(relx=0.78,rely=0.46)
        QC_Text3 = Text(Can8, width=23, bg="#f2f2f2",font=("Calibri",12),highlightbackground=None,highlightcolor=None,foreground="#515056",state='disabled',wrap="word")
        QC_Text3.place(relx=0.78,rely=0.51, width=180, height=24)
        QC_Text3.bind('<Tab>', lambda event: focusNext(QC_Text3))
        QC_Text3.bind('<Shift-Tab>', lambda event: focusPrev(QC_Text3))

        #---Comments---------------------------------------------------------------------------------------------------------------------
        QC_Label37 = Label(Can8,text="Comments",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
        QC_Label37.place(relx=0.03,rely=0.64)
        QC_Text4 = Text(Can8, width=23, bg="#f2f2f2",font=("Calibri",12),highlightbackground=None,highlightcolor=None,foreground="#515056",state='disabled')
        QC_Text4.place(relx=0.03,rely=0.69,width=480,height=55)
        QC_Text4.bind('<Tab>', lambda event: focusNext(QC_Text4))
        QC_Text4.bind('<Shift-Tab>', lambda event: focusPrev(QC_Text4))
        
        def QcSubmit():

        #---Producation Table Submit----    
            global NPHours
            global active_page
                
            # print(QC_T_WIT_Date.get())
            # print(today.strftime('%d-%m-%Y'))
            # if QC_T_WIT_Date.get()>today.strftime('%d-%m-%Y'):
            #     messagebox.showwarning("WARNING","No future date is WIT Processed Date")
            #     QC_T_WIT_Date.focus()
            #     return False        
        
            # if Login_c==1:
            #     QC_S_Time=str(Lst_Start_Time)
            # else:
            #     QC_S_Time=Old_Time
                
            # ###### New Entry #########
            # if len(str(NPTotalHours))==7 :
            #     NPTotalHours=str("0001-01-01 0")+str(NPTotalHours)
                
            # if len(str(Total_NP_Hours))==7 :
            #     Total_NP_Hours=str("0001-01-01 0")+str(Total_NP_Hours)
            #     NPTotalHours=str(NPTotalHours)
            # else:
            #     Total_NP_Hours=str(Total_NP_Hours)
            #     NPTotalHours=str(NPTotalHours)
                
            # Total_NP_Hours  = dt.timedelta(hours=int(Total_NP_Hours[11:13]),minutes=int(Total_NP_Hours[14:16]),seconds=int(Total_NP_Hours[17:19]))
            # NPTotalHours  = dt.timedelta(hours=int(NPTotalHours[11:13]),minutes=int(NPTotalHours[14:16]),seconds=int(NPTotalHours[17:19]))
            # P_Time = Total_NP_Hours + NPTotalHours
            
            QcEndDate=datetime.now().strftime('%d-%m-%Y %H:%M:%S')
            QcUniqID=UserID+datetime.now().strftime('%d%m%Y%H%M%S')
            QcNProductionHrs = NPHours.strftime( '%H:%M:%S')

            Qcdate=today.strftime('%d-%m-%Y')
            QCUserID=UserID
            WITProcessDate=QC_T_WIT_Date.get()
            RequestChannel=QC_Cb8.get()
            Transactions=QC_Cb9.get()
            AccountNo=QC_Ent10.get().strip()
            WITNumber=QC_Ent11.get().strip()
            Pos=QC_Cb10.get().find('-')
            ProcessorUserID=QC_Cb10.get()[0:Pos]
            ProcessorName=QC_Cb10.get()[Pos+1:]
            SkillLevel=QC_Cb11.get()

            # VD=QC_Ent13.get().find('$')
            # VP=QC_Ent13.get().find('')
            # VE=QC_Ent13.get().find('')

            #ValueNote=str(QC_Cb12.get()) + QC_Ent13.get()
            CompletedCorrectly=QC_Cb13.get()
            ErrorCode=QC_Cb14.get()
            ErrorDescription=QC_Text2.get(1.0,END).strip()
            ErrorRiskRating=QC_Text3.get(1.0,END).strip()
            QcCount=1
            QcComments=QC_Text4.get(1.0,END).strip()
            
            #Feedback_Date=""
            #Feedback_Given_By=""
            #Comments_on_Action=""
            

            if len(WITProcessDate)<1 or len(Transactions)<1 or len(WITNumber)<1 or len(ProcessorUserID)<1 or len(SkillLevel)<1 or len(CompletedCorrectly)<1:            
                messagebox.showerror("Alert", "Kindly update the required fields!")
                return False

            if CompletedCorrectly=='No':
                if len(ErrorCode)==0 or len(QcComments)==0:
                    messagebox.showwarning("Error Data Missing","Kindly check the Error code or commands Missing")
                    return False
            # if VP>-1 or VD>-1 or VE>-1:
            #     messagebox.showwarning("WARNING","Remove currency symbol from value box")
            #     return False
            
            #--QC Submit--
            query="INSERT INTO tblQc_Production (Qcdate, QCUserID, WITProcessDate,RequestChannel,Transactions,AccountNo,WITNumber,ProcessorUserID,ProcessorName,SkillLevel,CompletedCorrectly,ErrorCode,ErrorDescription,ErrorRiskRating,QcComments,QcUniqID,QcCount,QcStartDate,QcEndDate,QcNProductionHrs) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);"
            record=[Qcdate, QCUserID, WITProcessDate,RequestChannel,Transactions,AccountNo,WITNumber,ProcessorUserID,ProcessorName,SkillLevel,CompletedCorrectly,ErrorCode,ErrorDescription,ErrorRiskRating,QcComments,QcUniqID,QcCount,QcStartDate,QcEndDate,QcNProductionHrs]
            import_data(dbpath,query,record)
            messagebox.showinfo("Submitted","QC Details Submitted Successfully!")
            QC_Ent10.delete(0, END)
            QC_Ent11.delete(0, END)
            QC_Ent10.focus_set()
            QC_Ent13.delete(0, END)
            QC_Ent13.insert(0,'0.0')
            QC_Cb13.delete(0, END)
            QC_Cb13.insert(0, 'Yes')

            QC_Cb14.config(state='normal')
            QC_Cb14.delete(0, END)
            QC_Cb14.config(state='disabled')
            QC_Text2.config(state='normal')
            QC_Text2.delete(1.0, END)
            QC_Text2.config(state='disabled')
            QC_Text3.config(state='normal')
            QC_Text3.delete(1.0, END)
            QC_Text3.config(state='disabled')
            QC_Text4.delete(1.0, END)
            # QC_Ent12.delete(0,END)
            # QC_Ent12.insert(0,1)
            NPHours = datetime.min        
            active_page = False
            
        But9 = Button(Can8,text="Submit", width=12,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=QcSubmit)
        But9.place(relx=0.32,rely=0.90)        
        QC_Cb8.focus_set()
        
        def QC_Clear():
            global active_page
            active_page = False
            Qualitypage_check(stframe)
        
        But10 = Button(Can8,text="Clear", width=12,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=QC_Clear)
        But10.place(relx=0.50,rely=0.90)


    ######################################################################### End of Quality page ########################################
    
    
    ######################################################################### DashBoard Page start ########################################


    def dashboardPage():
            
        #But7.config(state='disabled',bg="#98d4e3",font=("Calibri", 11,"bold"))
        #But1.configure(background ='#00728F')
        #But2.configure(background ='#00728F')
        #But4.configure(background ='#00728F')
        But6.configure(background ='#00728F')
        But7.configure(background ='sky blue')

        Dash_w= Toplevel(ismaint)
        Dash_w.geometry("600x500+700+378")
        Dash_w.resizable(0,0)
        Dash_w.title("Dashboard")
        Dash_w.config(bg='white',)
        Dash_w.iconbitmap(icon_im)

        Dashline=Frame(Dash_w,width=600,height=1,bg='blue')
        Dashline.place(relx = 0.00, rely=0.00)

        #L_top=Frame(Dash_w,width=590,height=2,bg='#00728F')
        L_top=Frame(Dash_w,width=590,height=2,bg='Red')
        L_top.place(relx = 0.008, rely=0.21)

        bot=Frame(Dash_w,width=590,height=2,bg='Red')
        bot.place(relx = 0.008, rely=0.840)


        def DashSumbit():

            Dash_L_Login_T.config(text="Login Time : 0")  
            Dash_L_Logout_T.config(text="Logout Time : 0")
            Dash_L_Pro_Count.config(text="Production # : 0")
            Dash_L_Auth.config(text="Authorisation # : 0")
            Dash_L_QC_Count.config(text="QC # : 0")
                    
            UserDate=QC_E_Date.get()
            User_ID =  user_name
            User_ID = '92dharg'
            #print(User_ID)
            # -------- Login time checking  --------#
            
            query="Select Count(NPBreakItem) from tblhalt_NonP_Hrs where NPEntryBY=(?) and NpDate=(?) and  NPBreakItem='Login';"
            record=[User_ID, UserDate]
            Login_check=View_query(dbpath,query,record)
            Entry_count = Login_check[0][0]        
        
            if Entry_count == 0:
                messagebox.showwarning("Warning","You didn't Login respective days." )
                return False
                                                
            #-------Daily Availabe hours
            conn = sqlite3.connect(dbpath)
            conn_O = sqlite3.connect(Otherdb)
            
            # -------- Productioon  --------# 
            
            Prod_df = pd.read_sql_query("SELECT * FROM tblInput WHERE UserID= '"+ User_ID +"' and ProcessDate='"+ UserDate + "'  and Status = 'Completed' and Process_Status IN ('Re-update Done', 'Completed')", conn)
            Prod_df['ProcessDate'] = pd.to_datetime(Prod_df['ProcessDate'])
            P_df1 = Prod_df.rename(columns={"TransactionType": "Transactions"})
            #PMin_Max = Prod_df.groupby(['ProcessDate', 'UserID']).agg(Min_time = ('StartTime', np.min), Max_time = ('EndTime', np.max))
            P_df1 = P_df1.groupby(['Transactions'])['NoofItems'].sum().reset_index()
            Prod_count = P_df1['NoofItems'].sum()
            #print(P_df1)
            Dash_L_Pro_Count.config(text="Production # : "+str(Prod_count))
            
            
            # -------- Authorisation  --------#
            Auth_Prod = pd.read_sql_query("Select * From tblAuthorisation WHERE AuthUserID = '"+ User_ID +"' and Authdate = '" + UserDate +"' ", conn)
            Auth_Prod['Authdate'] = pd.to_datetime(Auth_Prod['Authdate'])    
            Auth_df = Auth_Prod.rename(columns={"AuthScreen" : "Transactions", "UserName" : "NoofItems" })
            Auth_df1  = Auth_df.groupby(['Transactions'])['NoofItems'].count().reset_index()
            Auth_count1 = Auth_Prod['UserName'].count()
            #Auth_df1 = P_df1.append(Auth_df1, ignore_index = False).fillna(0)
            #print(Auth_df1)
            Dash_L_Auth.config(text="Authorisation # : "+str(Auth_count1))
            
            
            # -------- QC  --------#
            Qc_df = pd.read_sql_query("Select * From tblQc_Production WHERE QCUserID = '"+ User_ID +"' and Qcdate ='" + UserDate +"' ", conn)
            Qc_df['Qcdate'] = pd.to_datetime(Qc_df['Qcdate'])
            Qc_df['WITProcessDate'] = pd.to_datetime(Qc_df['WITProcessDate'])
            Qc_df1 = Qc_df.groupby(['Transactions'])['QcCount'].sum().reset_index()
            QC_count1 = Qc_df1['QcCount'].sum()            
            Dash_L_QC_Count.config(text="QC # : "+str(QC_count1))
            #print(Qc_df1)
            #QC_df_Range =  pd.merge(Qc_df_day, QC_df_Range, how='outer', left_on=['Transactions', 'UserID'], right_on=['Transactions', 'UserID'], suffixes= ('_day', '_Range')).fillna(0)
            df = pd.merge(P_df1, Qc_df1, how='outer', left_on=['Transactions'], right_on=['Transactions']).fillna(0)
            #print(df)
            
            # -------- RPH Calculation  --------#
            conn_S = sqlite3.connect(Supportdb)
            Auth_RPH_df = pd.read_sql_query("Select Authorisationscreen, AuthRPH From tblISM_Process", conn_S) 
            Auth_RPH_df = Auth_RPH_df.rename(columns= {'Authorisationscreen' : 'Transactions'})
            Auth_RPH_df = Auth_RPH_df.groupby(['Transactions', 'AuthRPH']).size().reset_index()
            RPH_Auth = pd.merge(Auth_df1, Auth_RPH_df, how='left', left_on=['Transactions'], right_on= ['Transactions']).fillna(0)
            RPH_Auth.drop(columns=[0], axis=1, inplace=True)
            RPH_Auth['Auth_RPH']  = RPH_Auth['NoofItems'] / RPH_Auth['AuthRPH']
            Day_Auth = round(RPH_Auth['Auth_RPH'].sum(),2)
            # print(RPH_Auth)
            # print(Day_Auth)
            
            RPH_df = pd.read_sql_query("Select Transactions, ProductionRPH, QCRPH From tblISM_Process_1", conn_S)
            RPH_df = RPH_df.groupby(['Transactions', 'ProductionRPH', 'QCRPH']).size().reset_index()
            Productivity_df = pd.merge(df,RPH_df, how='left', left_on=['Transactions'], right_on=['Transactions']).fillna(0)
            Productivity_df['Prod_RPH'] = Productivity_df['NoofItems'] / Productivity_df['ProductionRPH'].astype(int)
            Productivity_df['QC_RPH'] = Productivity_df['QcCount'] / Productivity_df['QCRPH'].astype(int)
            Productivity_df['Total_RPH'] = Productivity_df['Prod_RPH'] + Productivity_df['QC_RPH']
            Day_RPH = round(Productivity_df['Total_RPH'].sum(),2) + Day_Auth
            #print(Day_RPH)
            #print(Productivity_df)
            #xw.view(Productivity_df,table=False)
                                    
            
            # -------- Non Productioon  --------#
            Non_Prod = pd.read_sql_query("Select * From tblhalt_NonP_Hrs Where NPEntryBY = '"+ User_ID +"' and NpDate = '"+ UserDate + "'", conn)
            Non_Prod['NpDate'] = pd.to_datetime(Non_Prod['NpDate'])
            
            Np_Min = Non_Prod.groupby(['NpDate', 'NPEntryBY' ]).agg(Min_time = ('NPStartTime', np.min), Max_time = ('NPEndTime', np.max)).reset_index()    
            Np_Min['Min_time']=pd.to_datetime(Np_Min['Min_time'])
            Np_Min['Max_time']=pd.to_datetime(Np_Min['Max_time'])
            Np_Min['Date_Diff'] = Np_Min['Max_time'] - Np_Min['Min_time']
            #print(Np_Min)
            Np_Min['Min_time'] = pd.to_datetime(Np_Min['Min_time'],format= '%H:%M:%S' ).dt.time
            LoginTime = Np_Min['Min_time'].sum()
            Np_Min['Max_time'] = pd.to_datetime(Np_Min['Max_time'],format= '%H:%M:%S' ).dt.time
            LogoutTime = Np_Min['Max_time'].sum()
            #Np_Min['Date_Diff'] = pd.to_datetime(Np_Min['Date_Diff'],format= '%H:%M:%S' ).dt.time
            Avl_hrs = Np_Min['Date_Diff'].sum()
            
            #NpMin = pd.to_datetime(Non_Prod['NPStartTime'])
            # NpMin = datetime.strptime(NpMin, '%d-%m-%Y %H:%M:%S').strftime('%H:%M:%S')
            # NpMax = Non_Prod['NPEndTime'].max()
            # NpMax = datetime.strptime(NpMax, '%d-%m-%Y %H:%M:%S').strftime('%H:%M:%S')
            # Avl_hrs = dt.timedelta(NpMax - NpMin)
            
            # NpMin = pd.to_datetime(Np_Min['Min_time']).dt.time
            # NpMax = pd.to_datetime(Np_Min['Max_time']).dt.time            
            #print(NpMin, NpMax)
            #print(Avl_hrs)
            # TMax_Min = PMin_Max.append(Np_Min).reset_index()    
            # TMax_Min = TMax_Min.groupby(['ProcessDate', 'UserID']).agg(Min_time = ('Min_time', np.min), Max_time = ('Max_time', np.max)).reset_index()
            # TMax_Min['Min_time']=pd.to_datetime(TMax_Min['Min_time'])
            # TMax_Min['Max_time']=pd.to_datetime(TMax_Min['Max_time'])
            # TMax_Min['Date_Diff'] = TMax_Min['Max_time'] - TMax_Min['Min_time']
            # Pro_avl_day = round(TMax_Min['Date_Diff'].sum()/pd.Timedelta(hours =1),2)
            
            # print(str(LoginTime))
            # print(str(LogoutTime))
            Dash_L_Login_T.config(text="Login Time : "+str(LoginTime))  
            if str(LoginTime) == str(LogoutTime):
                Dash_L_Logout_T.config(text="Logout Time : "+str('00:00:00'))
                            
            else:
                Dash_L_Logout_T.config(text="Logout Time : "+str(LogoutTime))            
            # print(Pro_avl_day)        
            
            #------- Break hours in Dashboard--------#   
            Non_Prod['NPStartTime'] = pd.to_datetime(Non_Prod['NPStartTime'])
            Non_Prod['NPEndTime'] = pd.to_datetime(Non_Prod['NPEndTime'])
            Non_Prod['Date_Diff'] = Non_Prod['NPEndTime'] - Non_Prod['NPStartTime']
            Day_Break = Non_Prod.loc[Non_Prod['NPBreakItem'] == 'Break']
            #Day_Break = pd.DataFrame(Non_Prod[Non_Prod['NPBreakItem'] == 'Break'])
            # print(Day_Break)
            Break_hrs = Day_Break['Date_Diff'].sum()
            # Current_break = round(Day_Break['Date_Diff'].sum()/pd.Timedelta(hours=1),2) 
                           
            if Break_hrs>dt.timedelta(hours=1, minutes=0, seconds=0):
                Dash_L_Break_Hours.config(text='Break Hours : '+str(Break_hrs).replace('0 days',''),fg='red')
                
            else:                
                Dash_L_Break_Hours.config(text='Break Hours : '+str(Break_hrs).replace('0 days',''),fg="#515056")
                                        
            
            #------- NonBreak hours in Dashboard--------#
            Day_NonHrs = Non_Prod.loc[Non_Prod['NPBreakItem'] !='Break']
            Diverted_hrs = Day_NonHrs['Date_Diff'].sum()
            #Current_Nhrs = round(Day_NonHrs['Date_Diff'].sum()/pd.Timedelta(hours=1),2)
            Dash_L_NPHrs.config(text="Diverted Hours : "+ str(Diverted_hrs).replace('0 days',''))            
            Total_Avl = Avl_hrs - Break_hrs
            #print(Total_Avl)
            
            user_avl = Total_Avl - Diverted_hrs
            #print(user_avl)
            Pro_avl = round(user_avl / pd.Timedelta(hours=1),2)
            #print(Pro_avl)
            
            # print(Day_RPH)
            # print(Pro_avl)
            if Day_RPH == 0.0 and Pro_avl == 0.0:
                productivity_day = 0.0
            else:    
                productivity_day = (Day_RPH/Pro_avl)*100 
            #print(productivity_day)
                            
            Dash_L_Pro_Percentage.config(text="Production % : "+str(round(productivity_day,2))+'%')            
            
            #------- Utalisation % --------#
            Total_Avl_d = round(Total_Avl/pd.Timedelta(hours=1),2)
            #print(Total_Avl_d)
            print('hourstest')
            print(pd.Timedelta(hours=1))
            if Total_Avl_d == 0.0 and Pro_avl ==0.0:
                Utilisation_day = 0.0
            else    :
                    
                Utilisation_day = (Pro_avl / Total_Avl_d)*100
            Dash_L_utilization.config(text="Utilisation % : "+str(round(Utilisation_day,2))+'%')
            #print(Utilisation_day)
            
            
            
            #------- QC % --------#
            Qc_df_wit = pd.read_sql_query("Select * From tblQc_Production WHERE ProcessorUserID = '"+ User_ID +"' and WITProcessDate ='" + UserDate +"' ", conn)
            Qc_df_wit['Qcdate'] = pd.to_datetime(Qc_df_wit['Qcdate'])
            Qc_df_wit['WITProcessDate'] = pd.to_datetime(Qc_df_wit['WITProcessDate'])
            #xw.view(Qc_df_wit, table=False)
            
            # -------- QC Itemcheced --------#                        
            Item_checked_day = Qc_df_wit['QcCount'].count()
            QC_Error = Qc_df_wit.loc[(Qc_df_wit['CompletedCorrectly'] == 'No')]
            QC_Error_day = QC_Error['QcCount'].sum() 

            #print(Item_checked_day, QC_Error_day)
            
            if QC_Error_day==0 or Item_checked_day==0 :
                Error_checked= 100 
            else:
                Error_checked =(1-(QC_Error_day/Item_checked_day))*100
                
            Dash_L_QC_Percentage.config(text="Quality % : "+str(round(Error_checked,2))+"%")
                                            
        #-------Date---------
        Dash_L_Date=Label(Dash_w,text="Date",fg="#515056",bg="white",bd=0, font=("Calibri", 12, "bold"))
        #Dash_L_Date.place(x=25+20,y=37)
        Dash_L_Date.place(relx = 0.07, rely=0.080)
        QC_E_Date=DateEntry(Dash_w, background= "black", foreground= "white",bd=2,font=('Calibri',12,"bold"),date_pattern='dd-MM-yyyy')
        QC_E_Date.place(relx = 0.07, rely=0.120,width=130, height=20+5)
        # today = dt.datetime.today()
        # offset = max(1, (today.weekday() + 6) % 7 - 3)
        # timedelta = dt.timedelta(offset)
        # most_recent = today - timedelta
        # P_Date=most_recent.strftime('%d-%m-%Y')
        # QC_E_Date._set_text(P_Date)

        #-------Login & Logout time---------

        Dash_L_Login_T=Label(Dash_w,text="Login Time :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_Login_T.place(relx = 0.09, rely=0.270)

        Dash_L_Logout_T=Label(Dash_w,text="Logout Time :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_Logout_T.place(relx = 0.59, rely=0.270)

        #-------Pro & QC Count ---------
        Dash_L_Pro_Count=Label(Dash_w,text="Production # :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_Pro_Count.place(relx = 0.09, rely=0.385)

        Dash_L_Auth = Label(Dash_w,text="Authorisation # :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_Auth.place(relx = 0.09, rely=0.500)


        Dash_L_QC_Count=Label(Dash_w,text="QC # :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_QC_Count.place(relx = 0.09, rely=0.615)

        Dash_L_utilization=Label(Dash_w,text="Utilisation % :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_utilization.place(relx = 0.59, rely=0.500)


        #-------Pro & QC  %---------
        Dash_L_Pro_Percentage=Label(Dash_w,text="Productivity % :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_Pro_Percentage.place(relx = 0.59, rely=0.385)

        Dash_L_NPHrs=Label(Dash_w,text="Diverted Hours :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_NPHrs.place(relx = 0.59, rely=0.730)

        Dash_L_QC_Percentage=Label(Dash_w,text="Quality % :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_QC_Percentage.place(relx = 0.59, rely=0.615)

        Dash_L_Break_Hours=Label(Dash_w,text="Break Hours :",fg="#515056",bg="white",bd=0, font=("Calibri", 13, "bold"))
        Dash_L_Break_Hours.place(relx = 0.09, rely=0.730)



        # Dash_Submit()

        S_button=Button(Dash_w,text=">", command=DashSumbit,font=("Bauhaus 93", 10,"bold"),bg='#00728F',fg='white',cursor="hand2")
        S_button.place(relx = 0.30, rely=0.120)
        
        ######################################################################### User Data download ########################################
            
            # - - Report Type - - 
        Dash_L_RType = Label(Dash_w,text="Report Type",fg="#515056",bg="white",bd=0, font=("Calibri", 9, "bold"))
        Dash_L_RType.place(relx = 0.05, rely=0.870)
        R_List=["Production ","Authorisation","Non_production","QC"]
        Dash_C_RType = AutocompleteCombobox(Dash_w ,font=("Calibri",11),foreground="#515056",completevalues=R_List,state='readonly')
        Dash_C_RType.place(relx = 0.05, rely=0.910, width=130)
        Dash_C_RType.config(state='normal')
        Dash_C_RType.insert(0,'Production')
        Dash_C_RType.config(state='readonly')

        
        def User_Report():
            S_Date=QC_E_Date.get()
            
            conn = sqlite3.connect(dbpath)
            Pro = "SELECT * FROM tblInput where UserID='"+ User_ID +"' and ProcessDate='"+ S_Date +"' "
            Pro1=[Pro]
            Auth = "SELECT * FROM tblAuthorisation where AuthUserID='"+ User_ID +"' and Authdate='"+ S_Date +"' "
            Auth1=[Auth]
            
            N_Pro = "SELECT * FROM tblhalt_NonP_Hrs where NPEntryBY='"+ User_ID +"' and NpDate='"+ S_Date +"'  "
            N_Pro1=[N_Pro]
            
            QC = "SELECT * FROM tblQc_Production where QCUserID='"+ User_ID +"' and Qcdate='"+ S_Date +"' "
            QC1=[QC]
            
            for q in Pro1:
                df1 = pd.read_sql_query(q, conn)
            for q in Auth1:
                df2 = pd.read_sql_query(q, conn)
            for q in N_Pro1:
                df3 = pd.read_sql_query(q, conn)
            for q in QC1:
                df4 = pd.read_sql_query(q, conn)
                            

            if Dash_C_RType.get().strip()=="Production":
                conn.close()
                messagebox.showinfo('Finished','User Report Created!')
                xw.view(df1, table=False)
                
            elif Dash_C_RType.get().strip() =="Authorisation":
                conn.close()
                messagebox.showinfo("Finished", 'Authorise Report Created')
                xw.view(df2, table=False)
                
            elif Dash_C_RType.get().strip()=="Non_production":
                conn.close()
                messagebox.showinfo('Finished','User Report Created!')
                xw.view(df3, table=False)
                
            elif Dash_C_RType.get().strip()=="QC":
                conn.close()
                messagebox.showinfo('Finished','User Report Created!')
                xw.view(df4, table=False)
            conn.close()
                    
        Report_button=Button(Dash_w,text="User Data", command=User_Report,font=("Calibri", 11,"bold"),bg='#00728F',fg='white',cursor="hand2")
        Report_button.place(relx = 0.28, rely=0.907, height=26)
        
        
        #----------------------------Raw Report---------------------------       
        
        def Raw_Report():        
                    
            if len(Admin_E_SDate.get())<1 or len(Admin_E_EDate.get())<1:
                messagebox.showerror("Data Missing", "Select Start and End Date")
                Dash_w.focus_force()
                return False
            
            if Admin_E_SDate.get() > Admin_E_EDate.get() :
                messagebox.showerror("Data Missing", "Incorrect Start and End Date")
                Dash_w.focus_force()
                return False
                
            ReportPath = fd.askdirectory(title='Select Folder Path')
            if ReportPath != '':
                F_Date=Admin_E_SDate.get()
                T_Date=Admin_E_EDate.get() 
                
         # -------- Date formate changed  --------#  
                Dash_Sdate=Admin_E_SDate.get()                   
                Dash_Sdate=dt.datetime.strptime(Dash_Sdate, "%d-%m-%Y").strftime('%Y-%m-%d')
                # print(Dash_Sdate)
                Dash_Edate=Admin_E_EDate.get()                   
                Dash_Edate=dt.datetime.strptime(Dash_Edate, "%d-%m-%Y").strftime('%Y-%m-%d')
                # print(Dash_Edate)
                
                TempPath = ReportPath + r"/IS-Maintenance Raw Data " + datetime.now().strftime('%d-%m-%Y %H%M%S') + ".xlsx"
                
                # query1 = "select * from tblInput where  ProcessDate >= '"+ F_Date +"' and ProcessDate <= '"+ T_Date +"' ";           
                # query2 = "SELECT * FROM tblAuthorisation where ProcessDate >= '"+ F_Date +"' and ProcessDate <= '"+ T_Date +"' ";
                # query3 = "select * from tblhalt_NonP_Hrs where   NpDate >= '"+ F_Date +"' and NpDate"
                #query4 = "select * from tblQc_Production where WITProcessDate between '"+ F_Date +"' AND '"+ T_Date +"' or Uniq_ID in (SELECT Uniq_ID from TblQCProducation WHERE QC_Date >= '"+ F_Date +"' AND QC_Date <= '"+ T_Date +"')"
                #query4 = "SELECT * FROM tblQc_Production where WITProcessDate >= '"+ F_Date +"' and WITProcessDate <='"+ T_Date +"' "
                
                Excelsheets = ['Production', 'Authorisation', 'Non_Production', 'QC']
                writer = pd.ExcelWriter(TempPath, engine = 'xlsxwriter')
                
                # Production = pd.DataFrame()
                # Non_Production = pd.DataFrame()
                # Authorisation = pd.DataFrame()
                # QC = pd.DataFrame()
                            
                try:
                    conn = sqlite3.connect(dbpath,timeout=45,uri=True)
                    
                    # -------- Production Raw Data  --------#  
                    # Production = pd.read_sql_query(query1, conn)
                    Production = pd.read_sql_query("SELECT * FROM tblInput", conn)
                    
                    Production['ProcessDate'] = pd.to_datetime(Production['ProcessDate'], format= '%d-%m-%Y')                                        
                                        
                    Production = Production.loc[(Production['ProcessDate']>= Dash_Sdate) & (Production['ProcessDate'] <= Dash_Edate)] 
                    Production['ProcessDate'] = pd.to_datetime(Production['ProcessDate']).dt.strftime('%d/%m/%Y')
                    
                    # -------- Authorisation Raw Data  --------#  
                    # Authorisation = pd.read_sql_query(query2, conn)
                    Authorisation = pd.read_sql_query("SELECT * FROM tblAuthorisation", conn)
                                
                    Authorisation['Authdate'] = pd.to_datetime(Authorisation['Authdate'], format = '%d-%m-%Y')       
                    # Authorisation['ProcessDate'] = pd.to_datetime(Authorisation['ProcessDate'])
                    # Authorisation['ProcessDate'] = pd.to_datetime(Authorisation['ProcessDate'], format = '%d-%m-%Y')
                                
                    # Auth_Sdate=dt.datetime.strptime(Dash_Sdate, '%Y-%m-%d').strftime('%d-%m-%Y') 
                    # Auth_Edate=dt.datetime.strptime(Dash_Edate, '%Y-%m-%d').strftime('%d-%m-%Y')     
                    # print(Auth_Sdate, Auth_Edate)
                    # xw.view(Authorisation, table=False)
                    print(Dash_Sdate, Dash_Edate)
                    Authorisation = Authorisation.loc[(Authorisation['Authdate']>= Dash_Sdate) & (Authorisation['Authdate'] <= Dash_Edate)] 
                    
                    #Auth_df2 = Authorisation.loc[(Authorisation['ProcessDate']>= Auth_Sdate) & (Authorisation['ProcessDate'] <= Auth_Edate)] 

                    #Authorisation=Auth_df1.append(Auth_df2, ignore_index=True)
                    #Authorisation=Authorisation.drop_duplicates(subset=['UniqID'])
                    Authorisation['Authdate'] = pd.to_datetime(Authorisation['Authdate']).dt.strftime('%d/%m/%Y')
                    #Authorisation['ProcessDate'] = pd.to_datetime(Authorisation['ProcessDate']).dt.strftime('%d/%m/%Y')
                                        
                
                    # -------- Non_Production Raw Data  --------#                     
                    # Non_Production = pd.read_sql_query(query3, conn)
                    Non_Production = pd.read_sql_query("SELECT * FROM tblhalt_NonP_Hrs", conn)
                    
                    Non_Production['NpDate'] = pd.to_datetime(Non_Production['NpDate'], format= '%d-%m-%Y')                                        
                                        
                    Non_Production = Non_Production.loc[(Non_Production['NpDate']>= Dash_Sdate) & (Non_Production['NpDate'] <= Dash_Edate)] 
                    Non_Production['NpDate'] = pd.to_datetime(Non_Production['NpDate']).dt.strftime('%d/%m/%Y')
                    
                    # -------- QC Raw Data  --------#  
                    #QC = pd.read_sql_query(query4, conn)
                    QC = pd.read_sql_query("SELECT * FROM tblQc_Production", conn)
                    
                    QC['Qcdate'] = pd.to_datetime(QC['Qcdate'], format= '%d-%m-%Y')                    
                    #QC['WITProcessDate'] = pd.to_datetime(QC['WITProcessDate'], format= '%d-%m-%Y')
                                        
                    QC = QC.loc[(QC['Qcdate']>= Dash_Sdate) & (QC['Qcdate'] <= Dash_Edate)] 
                    #QC_df2 = QC.loc[(QC['WITProcessDate']>= Dash_Sdate) & (QC['WITProcessDate'] <= Dash_Edate)] 

                    #QC=QC_df1.append(QC_df2, ignore_index=True)
                    #QC=QC.drop_duplicates(subset=['QcUniqID'])
                    QC['Qcdate'] = pd.to_datetime(QC['Qcdate']).dt.strftime('%d/%m/%Y')
                    QC['WITProcessDate'] = pd.to_datetime(QC['WITProcessDate']).dt.strftime('%d/%m/%Y')                    
                    
                    conn.close()  
                except:
                    conn.close()
                    messagebox.showerror("Data Crash","IS-Maintenance data crashed, Please reopen the tool")
                    return False
                            
                
                Dfs=[Production, Authorisation, Non_Production, QC]
                i=0
                for q in Dfs:
                    q.to_excel(writer, sheet_name=Excelsheets[i], index=False)
                    i=i+1
                conn.close()
                writer.save()
                #writer.close()
                writer.handles = None
                
                messagebox.showinfo('Office Inn Raw Data','IS-Maintenance Raw Data Report Exported!')
                startfile(TempPath)
            else:
                messagebox.showerror('Folder Validation','Folder Path Not Selected!')
                
        #--Start Date--
        
        Admin_L_SDate=Label(Dash_w,text="Start Date",fg="#515056",bg="white",bd=0, font=("Calibri", 9, "bold"))
        # Admin_L_SDate.place(relx = 0.51, rely=0.870)
        Admin_E_SDate=DateEntry(Dash_w, background= "Black", foreground= "white", bd=2,font=('Calibri',11),date_pattern='dd-MM-yyyy',maxdate=date.today())
        # Admin_E_SDate.place(relx = 0.51, rely=0.910,  width=95)

        Admin_L_EDate=Label(Dash_w,text="End Date",fg="#515056",bg="white",bd=0, font=("Calibri", 9, "bold"))
        # Admin_L_EDate.place(relx = 0.68, rely=0.870)
        Admin_E_EDate=DateEntry(Dash_w, background= "black", foreground= "white",bd=2,font=('Calibri',11),date_pattern='dd-MM-yyyy',maxdate=date.today())
        # Admin_E_EDate.place(relx = 0.68, rely=0.910, width=95)
        
        Raw_Report_Button = Button(Dash_w, text="Raw Data",bg="#00728F",foreground="white",font=("Calibri", 11,"bold"),command=Raw_Report,cursor="hand2" )
        # Raw_Report_Button.place(relx = 0.85, rely=0.907, height=26)
        
        #---------------------------- Admin access check ---------------------------#
            
        Admin_check = Select_data(Supportdb, "Select USER_ID from TblUser_data where USER_ID ='"+ User_ID +"' and Admin_Access ='Yes' and ISM_Authoriser ='Yes';")
        if len(Admin_check) != 0:
            Admin_L_SDate.place(relx = 0.51, rely=0.870)
            Admin_E_SDate.place(relx = 0.51, rely=0.910,  width=95)
            Admin_L_EDate.place(relx = 0.68, rely=0.870)
            Admin_E_EDate.place(relx = 0.68, rely=0.910, width=95)
            Raw_Report_Button.place(relx = 0.85, rely=0.907, height=26)
    
        
        def Dash_avoid():
                Dash_w.destroy()
                ismaint.focus_force()
                But7.configure(background ='#00728F')
                #Dashboard_Button.config(state='normal',bg="#00728F",font=("Calibri", 11,"bold"))

        Dash_w.grab_set() 
        Dash_w.protocol("WM_DELETE_WINDOW", Dash_avoid)

    # def Admin_ISM(stframe):
    #     global active_page
    #     active_page = True 
    #     record = [user_name]    
    #     query = ("Select * from TblUser_data where USER_ID =? and User_Access ='Yes' and Admin_Access = 'Yes';")
    #     user_access = View_query(Supportdb,query,record)
         
    #     if len(user_access) <= 0 :
    #         messagebox.showerror("Admin Validation","You don't have admin access, Kindly check with your team leader!")
    #         return False
        
    #     Can9 = Canvas(stframe,bg="white", height=515,width=1178,highlightthickness=0)
    #     Can9.place(relx=0.00,rely=0.11) 
        
    #     # -------- UserID & Current date   --------#                
        
    #     # Label25 = Label(Can9,text="UserID",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 9, "bold"))
    #     # Label25.place(relx=0.40,rely=0.018)
    #     # Com_list12 = Select_data(Supportdb, "SELECT * FROM TblUser_data")
    #     # Cb12 = AutocompleteCombobox(Can9, font=("Calibri",11,), completevalues= Com_list12)
    #     # Cb12.place(relx=0.40,rely=0.060, width=125, height=23)
        
    #     # Label26 = Label(Can9,text="Date",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 9, "bold"))
    #     # Label26.place(relx=0.52,rely=0.018)
    #     # date_ent2 = DateEntry(Can9, background= "black", foreground= "white",bd=0,font=('Calibri',11), date_pattern='dd-mm-yyyy', maxdate = date.today())        
    #     # date_ent2.place(relx=0.52,rely=0.060, width=125,height=23)
        
    #     # But17=Button(Can9,text=">>", command='',font=("Bauhaus 93", 10,"bold"),bg='#00728F',fg='white',cursor="hand2")
    #     # But17.place(relx = 0.64, rely=0.055)
        
    #     # -------- Admin Treeview   --------#
    #     sty = ttk.Style()
    #     sty.theme_use('default')
    #     tree1_header = ["ProcessDate","UserID","CaseReference","Transaction","AccountNo","Authorisation","Authorise ID","Status","c9" ]
    #     is_tree3 = MyTreeview(Can9,columns=tree1_header, show='headings',height=21,)
    #     is_tree3.column("#1",anchor=CENTER,width=70)
    #     is_tree3.heading("#1",text="ProcessDate")
    #     is_tree3.column("#2",anchor=CENTER,width=60)
    #     is_tree3.heading("#2",text="UserID")
    #     is_tree3.column("#3",anchor=CENTER,width=85)
    #     is_tree3.heading("#3",text="CaseReference")
    #     is_tree3.column('#4',anchor=CENTER,width=90)
    #     is_tree3.heading('#4',text="Transaction")
    #     is_tree3.column('#5',anchor=CENTER,width=100)
    #     is_tree3.heading('#5',text="AccountNo")
    #     is_tree3.column('#6',anchor=CENTER,width=80)
    #     is_tree3.heading('#6',text="Authorisation")
    #     # is_tree3.column('#7', anchor=CENTER,width=80)
    #     # is_tree3.heading('#7',text="AuthDate")
    #     is_tree3.column('#7',anchor=CENTER,width=70)
    #     is_tree3.heading('#7',text="AuthoriseID")
    #     is_tree3.column('#8',anchor=CENTER,width=105)
    #     is_tree3.heading('#8',text="Status")
    #     is_tree3.column('#9', minwidth=0, width=0)
        
        
    #     # -------- Treeview3 sort  --------# 
    #     tree1sort = ["date","name","name","name","name","name","name","name","name","name"]
    #     for iCount in range(len(tree1_header)):
    #         strHdr = tree1_header[iCount]
    #         is_tree3.heading(strHdr, text=strHdr.title(), sort_by=tree1sort[iCount])
    #         is_tree3.column(tree1_header[iCount], stretch=True)
                
    #     is_tree3.place(relx=0.020,rely=0.13)        
    #     scrol_input= Scrollbar(Can9,orient="vertical",command=is_tree3.yview)
    #     scrol_input.place(relx=0.585,rely=0.13,height=440)
    #     is_tree3.configure(yscrollcommand= scrol_input.set)
        
    #     # -------- Admin Clear   --------# 
    #     def Admin_Clear(Processtype=''):
            
    #         if Processtype !='' or Processtype == '':                      
    #             Ent10.config(state='normal')
    #             Ent10.delete(0, END)
    #             Cb13.config(state='normal')
    #             Cb13.delete(0,END)
    #             Cb14.config(state='normal')
    #             Cb14.delete(0,END)
    #             Cb15.config(state='normal')
    #             Cb15.delete(0,END)
        
        
    #     # -------- Treeview data viewed   --------# 
    #     def Selected_tree3(event):
    #         global Ad_uniqID
    #         global Processtype
    #         Admin_Radio = Ad_options.get()
    #         try:
    #             Ent10.config(state='normal')
    #             Ent10.delete(0,END)                                
    #             Cb13.config(state='normal')
    #             Cb13.delete(0, END)
    #             Cb14.config(state='normal')
    #             Cb14.delete(0,END)
    #             Cb15.config(state='normal')                
    #             Cb15.delete(0, END)
                
                    
    #             for item in is_tree3.selection():
    #                 item_select3 =is_tree3.item(item)
    #                 Processdate = item_select3['values'][0]
    #                 Inputuserid = item_select3['values'][1]
    #                 AuthoriseID = item_select3['values'][6]
    #                 Process_status = item_select3['values'][7]
    #                 Ad_uniqID = item_select3['values'][9]
    #                 # print(Ad_uniqID)
    #             if Admin_Radio ==1 :  
                                                                  
    #                     Ent10.insert(END, Processdate)
    #                     Ent10.config(state='disabled')
    #                     Cb13.insert(END, Inputuserid)
    #                     Cb14.insert(END, AuthoriseID)
    #                     Cb14.config(state='disabled')
    #                     Cb15.insert(END, Process_status)
    #                     Cb15.config(state='disabled')
    #                     Processtype = 'Input'
    #             elif Admin_Radio ==2 : 
                        
    #                     Processtype = 'Authorisation'                                                                         
    #                     Ent10.insert(END, Processdate)
    #                     Ent10.config(state='disabled')
    #                     Cb13.insert(END, Inputuserid)
    #                     Cb13.config(state ='disabled')
    #                     Cb14.insert(END, AuthoriseID)                                                                     
    #                     Cb15.insert(END, Process_status) 
    #                     Pstatus = Cb15.get()                                                                                                   
    #                     Com_select14(Pstatus=Pstatus)                                                
                                                                           
    #         except:
    #             pass
        
    #  # -------- Process status checking   --------#     
    #     def Com_select14(Pstatus):
    #         if  Pstatus =='Auth - Unassigned' or Cb15.get() == 'Auth - Unassigned' :
    #             Cb14.delete(0, END)
    #             Cb14.config(state ='disabled')
    #         elif Pstatus == 'Auth - InProcess' or Cb15.get() == 'Auth - InProcess':
    #             Cb14.config(state ='normal')
                
    #     is_tree3.bind('<<TreeviewSelect>>', lambda event: Selected_tree3(event))    
        
        
    #     #-------- Tree3 Viewed all input userdata data in admin queue --------#
    #     def Adradio_selected():
            
    #         Select_adradio = Ad_options.get()
    #         if Select_adradio == 1:
                
    #             is_tree3.delete(*is_tree3.get_children())
    #             conn = sqlite3.connect(dbpath)                
    #             #User_data = [User_ID]
    #             query = """SELECT ProcessDate, UserID, CaseReference, TransactionType, AccountNumber, Authorisation, B.AuthoriserID, B.CurrentStatus,  Process_Status, A.UniqueID, Status, AuthStatus, MAX(PrimaryID) FROM tblInput AS A 
    #                         INNER JOIN (Select AuthoriserID, CurrentStatus, C.UniqueID from tblMain AS C) AS B
    #                         ON A.UniqueID = B.UniqueID
    #                         WHERE A.UniqueID IN (Select D.UniqueID from tblMain AS D WHERE CurrentStatus in ('IP - In Process', 'IP - Diarised', 'IP - Re-update Required', 'IP - Rejected')) 
    #                         GROUP BY A.UniqueID HAVING Process_Status IN ('In Process', 'Diarised', 'Re-update Required', 'Rejected');"""
                
    #             # query = """SELECT ProcessDate, UserID, CaseReference, TransactionType, AccountNumber, Authorisation, Status, AuthStatus, Process_Status, UniqueID, MAX(PrimaryID) FROM tblInput WHERE UniqueID IN (Select UniqueID from tblMain WHERE CurrentStatus in ('IP - In Process', 'IP - Diarised', 'IP - Re-update Required', 'IP - Rejected')) 
    #             #             GROUP BY UniqueID HAVING Process_Status IN ('In Process', 'Diarised', 'Re-update Required', 'Rejected');"""
                
    #             c_conn = conn.execute(query);
    #             rows = c_conn.fetchall();
    #             conn.close()

    #             for rw in rows:                
    #                 is_tree3.insert("",tkinter.END,values=rw)
                    
    #         elif Select_adradio == 2:
                
    #             is_tree3.delete(*is_tree3.get_children())
    #             conn = sqlite3.connect(dbpath)
    #             query = """SELECT ProcessDate, UserID, CaseReference, TransactionType, AccountNumber, Authorisation, B.AuthoriserID, B.CurrentStatus, Process_Status, A.UniqueID, Status, AuthStatus, MAX(PrimaryID) FROM tblInput AS A 
    #                         INNER JOIN (Select AuthoriserID, CurrentStatus, C.UniqueID from tblMain AS C) AS B
    #                         ON A.UniqueID = B.UniqueID
    #                         WHERE A.UniqueID IN (Select D.UniqueID from tblMain AS D WHERE Authorisation = 'Yes' AND CurrentStatus in ('IP - Completed', 'Auth - InProcess', 'Auth - Unassigned', 'IP - Re-update Done')) 
    #                         GROUP BY A.UniqueID HAVING Process_Status IN ('Completed', 'Re-update Done');"""
    #             c_conn = conn.execute(query);
    #             rows = c_conn.fetchall();
    #             conn.close()
                
    #             for r in rows:
    #                 is_tree3.insert("", tkinter.END,values = r)
                    
    #     Ad_options = IntVar()
    #     Ad_options.set(1)
    #     Adradio_selected()
    #     Rd3 = Radiobutton(Can9,text="Input", variable=Ad_options, value=1,command=Adradio_selected, bg='white', fg='black', activeforeground='red', selectcolor='white', font=("Calibri",11,"bold"))
    #     Rd3.place(relx=0.015,rely=0.057)
    #     Rd4 = Radiobutton(Can9,text="Authorisation", variable=Ad_options, value=2,command=Adradio_selected, bg='white', fg='black', activeforeground='red', selectcolor='white', font=("Calibri",11,"bold"))
    #     Rd4.place(relx=0.08,rely=0.057)
        
    #     # -------- Admin Sumbit   --------# 
    #     def Admin_sumbit():
    #         UniqueID = Ad_uniqID
           
    #         if Cb15.get() == 'Auth - Unassigned' and Processtype == 'Authorisation':
    #             query = ("Update tblMain set AuthoriserID =?, CurrentStatus =? Where UniqueID=?;")
    #             record = ('', Cb15.get(), UniqueID)
    #             Update_query(query,record)
    #             messagebox.showinfo("data update", 'Transaction has been updated!')
    #             Admin_Clear(Processtype = Processtype)
    #         elif len(Cb13.get())>0:
                
    #             if Cb13.get() not in Com_list13:
    #                 messagebox.showerror("Incorrect User ID", "Kindly update valid User ID")
    #                 Cb13.focus_set()                
    #                 Cb13.delete(0, END)
    #                 return False
    #             elif Processtype == 'Input':                   
    #                 query = ("Update tblInput set UserID =? Where PrimaryID in (Select Max(PrimaryID) from tblInput where UniqueID=?);")
    #                 record = (Cb13.get(),UniqueID)
    #                 Update_query(query,record)
    #                 Cb13.delete(0, END)
    #                 messagebox.showinfo("data update", 'Transaction has been updated!')
    #                 Admin_Clear(Processtype = Processtype)
                    
    #             elif Cb14.get() not in Com_list14:
    #                 messagebox.showerror("Incorrect User ID", "Kindly update valid User ID")
    #                 Cb13.focus_set()                
    #                 Cb13.delete(0, END)
    #                 return False
    #             elif Processtype == 'Authorisation':
    #                 query = ("Update tblMain set AuthoriserID =?, CurrentStatus =? Where UniqueID=?;")
    #                 record = (Cb14.get(), Cb15.get(), UniqueID)
    #                 Update_query(query,record)
    #                 messagebox.showinfo("data update", 'Transaction has been updated!')
    #                 Admin_Clear(Processtype = Processtype)
    #     # -------- work queue acces changes   --------# 
    #     Label26 = Label(Can9,text="Process Date",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
    #     Label26.place(relx=0.650,rely=0.16)
    #     Ent10 = Entry(Can9, width=22,bg="white", font=("Calibri",11),highlightbackground=None,highlightcolor=None)
    #     Ent10.place(relx=0.750,rely=0.16,height=23)
        
    #     Label27 = Label(Can9,text="UserID",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
    #     Label27.place(relx=0.650,rely=0.28)
    #     Com_list13 = Select_data(Supportdb, "SELECT * FROM TblUser_data")
    #     Cb13 = AutocompleteCombobox(Can9,width=21, completevalues=Com_list13, font=("Calibri",11))
    #     Cb13.place(relx=0.750,rely=0.28)
    #     # Cb13.bind("<<ComboboxSelected>>", Aduserid_Check)
    #     # Cb13.bind("<FocusOut>", Aduserid_Check)
        
    #     Label28 = Label(Can9,text="AuthoriserID",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
    #     Label28.place(relx=0.650,rely=0.40)
    #     Com_list14 = Select_data(Supportdb, "SELECT * FROM TblUser_data")
    #     Cb14 = AutocompleteCombobox(Can9,width=21, completevalues=Com_list14, font=("Calibri",11))
    #     Cb14.place(relx=0.750,rely=0.40)
        
    #     Label29 = Label(Can9,text="Status",fg="#515056",bg="white",bd=0, font=("Calibri (Body)", 10, "bold"))
    #     Label29.place(relx=0.650,rely=0.52)
    #     Cb15 = AutocompleteCombobox(Can9,width=21, completevalues=['Auth - Unassigned','Auth - InProcess' ], font=("Calibri",11))
    #     Cb15.place(relx=0.750,rely=0.52)
    #     Cb15.bind('<<ComboboxSelected>>', Com_select14)
    #     Cb15.bind('<FocusOut>', Com_select14)
        
    #     But18 = Button(Can9,text="Submit", width=11,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=Admin_sumbit)
    #     But18.place(relx=0.650,rely=0.65)
    #     But19 = Button(Can9,text="Clear", width=11,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=Admin_Clear)
    #     But19.place(relx=0.750,rely=0.65)
    #     But20 = Button(Can9,text="Refresh", width=11,height=0,bg="#00728F",foreground="white", font=("Calibri (Body)", 9,"bold"),borderwidth=3,command=Adradio_selected)
    #     But20.place(relx=0.850,rely=0.65)
        
    #      #----------------------------Raw Report---------------------------       
        
    #     def Raw_Report():        
                    
    #         if len(Admin_E_SDate.get())<1 or len(Admin_E_EDate.get())<1:
    #             messagebox.showerror("Data Missing", "Select Start and End Date")
    #             Can9.focus_force()
    #             return False
            
    #         if Admin_E_SDate.get() > Admin_E_EDate.get() :
    #             messagebox.showerror("Data Missing", "Incorrect Start and End Date")
    #             Can9.focus_force()
    #             return False
                
    #         ReportPath = fd.askdirectory(title='Select Folder Path')
    #         if ReportPath != '':
                                
    #      # -------- Date formate changed  --------#  
    #             Dash_Sdate=Admin_E_SDate.get()                   
    #             Dash_Sdate=dt.datetime.strptime(Dash_Sdate, "%d-%m-%Y").strftime('%Y-%m-%d')
    #             # print(Dash_Sdate)
    #             Dash_Edate=Admin_E_EDate.get()                   
    #             Dash_Edate=dt.datetime.strptime(Dash_Edate, "%d-%m-%Y").strftime('%Y-%m-%d')
    #             # print(Dash_Edate)
                
    #             TempPath = ReportPath + r"/IS-Maintenance Raw Data " + datetime.now().strftime('%d-%m-%Y %H%M%S') + ".xlsx"
                
                
    #             Excelsheets = ['Production', 'Authorisation', 'Non_Production', 'QC']
    #             writer = pd.ExcelWriter(TempPath, engine = 'xlsxwriter')
                
    #             # Production = pd.DataFrame()
    #             # Non_Production = pd.DataFrame()
    #             # Authorisation = pd.DataFrame()
    #             # QC = pd.DataFrame()
                            
    #             try:
    #                 conn = sqlite3.connect(dbpath,timeout=45,uri=True)
                    
    #                 # -------- Production Raw Data  --------#  
    #                 # Production = pd.read_sql_query(query1, conn)
    #                 Production = pd.read_sql_query("SELECT * FROM tblInput", conn)
                    
    #                 Production['ProcessDate'] = pd.to_datetime(Production['ProcessDate'], format= '%d-%m-%Y')                                        
                                        
    #                 Production = Production.loc[(Production['ProcessDate']>= Dash_Sdate) & (Production['ProcessDate'] <= Dash_Edate)] 
    #                 Production['ProcessDate'] = pd.to_datetime(Production['ProcessDate']).dt.strftime('%d/%m/%Y')
                    
    #                 # -------- Authorisation Raw Data  --------#  
    #                 # Authorisation = pd.read_sql_query(query2, conn)
    #                 Authorisation = pd.read_sql_query("SELECT * FROM tblAuthorisation", conn)

                    # Authorisation['ProcessDate'] = pd.to_datetime(Authorisation['ProcessDate'])
    #                 Authorisation['ProcessDate'] = pd.to_datetime(Authorisation['ProcessDate'], format= '%d-%m-%Y')
    #                 Authorisation['Auth_date']=pd.to_datetime(Authorisation['AuthEndTime']).dt.date
    #                 Authorisation['Auth_date'] = pd.to_datetime(Authorisation['Auth_date'])                                        
                    
    #                 Auth_Sdate=dt.datetime.strptime(Dash_Sdate, '%Y-%m-%d').strftime('%Y-%m-%d') 
    #                 Auth_Edate=dt.datetime.strptime(Dash_Edate, '%Y-%m-%d').strftime('%Y-%m-%d')
                    
    #                 Auth_df1 = Authorisation.loc[(Authorisation['Auth_date']>= Auth_Sdate) & (Authorisation['Auth_date'] <= Auth_Edate)] 
    #                 Auth_df2 = Authorisation.loc[(Authorisation['ProcessDate']>= Dash_Sdate) & (Authorisation['ProcessDate'] <= Dash_Edate)] 
    #                 Authorisation=Auth_df1.append(Auth_df2, ignore_index=True)
    #                 Authorisation=Authorisation.drop_duplicates(subset=['UniqID','AuthEndTime'])
                    
    #                 Authorisation['Auth_date'] = pd.to_datetime(Authorisation['Auth_date']).dt.strftime('%d/%m/%Y')
    #                 Authorisation['ProcessDate'] = pd.to_datetime(Authorisation['ProcessDate']).dt.strftime('%d/%m/%Y')
                
    #                 # -------- Non_Production Raw Data  --------#                     
    #                 # Non_Production = pd.read_sql_query(query3, conn)
    #                 Non_Production = pd.read_sql_query("SELECT * FROM tblhalt_NonP_Hrs", conn)
                    
    #                 Non_Production['NpDate'] = pd.to_datetime(Non_Production['NpDate'], format= '%d-%m-%Y')                                        
                                        
    #                 Non_Production = Non_Production.loc[(Non_Production['NpDate']>= Dash_Sdate) & (Non_Production['NpDate'] <= Dash_Edate)] 
    #                 Non_Production['NpDate'] = pd.to_datetime(Non_Production['NpDate']).dt.strftime('%d/%m/%Y')
                    
    #                 # -------- QC Raw Data  --------#  
    #                 #QC = pd.read_sql_query(query4, conn)
    #                 QC = pd.read_sql_query("SELECT * FROM tblQc_Production", conn)
                    
    #                 QC['Qcdate'] = pd.to_datetime(QC['Qcdate'], format= '%d-%m-%Y')                    
    #                 QC['WITProcessDate'] = pd.to_datetime(QC['WITProcessDate'], format= '%d-%m-%Y')
                                        
    #                 QC_df1 = QC.loc[(QC['Qcdate']>= Dash_Sdate) & (QC['Qcdate'] <= Dash_Edate)] 
    #                 QC_df2 = QC.loc[(QC['WITProcessDate']>= Dash_Sdate) & (QC['WITProcessDate'] <= Dash_Edate)] 

    #                 QC=QC_df1.append(QC_df2, ignore_index=True)
    #                 QC=QC.drop_duplicates(subset=['QcUniqID'])
    #                 QC['Qcdate'] = pd.to_datetime(QC['Qcdate']).dt.strftime('%d/%m/%Y')
    #                 QC['WITProcessDate'] = pd.to_datetime(QC['WITProcessDate']).dt.strftime('%d/%m/%Y')                    
                    
    #                 conn.close()  
    #             except:
    #                 conn.close()
    #                 messagebox.showerror("Data Crash","IS-Maintenance data crashed, Please reopen the tool")
    #                 return False
                            
                
    #             Dfs=[Production, Authorisation, Non_Production, QC]
    #             i=0
    #             for q in Dfs:
    #                 q.to_excel(writer, sheet_name=Excelsheets[i], index=False)
    #                 i=i+1
    #             conn.close()
    #             writer.save()
    #             #writer.close()
    #             writer.handles = None
                
    #             messagebox.showinfo('Office Inn Raw Data','IS-Maintenance Raw Data Report Exported!')
    #             startfile(TempPath)
    #         else:
    #             messagebox.showerror('Folder Validation','Folder Path Not Selected!')
                
    #     #--Start Date--
    #     Admin_L_SDate=Label(Can9,text="Raw Data",fg="#515056",bg="white",bd=0, font=("Calibri body", 11, "bold"))
    #     Admin_L_SDate.place(relx = 0.770, rely=0.750)
    #     Admin_L_SDate=Label(Can9,text="Start Date",fg="#515056",bg="white",bd=0, font=("Calibri", 9, "bold"))
    #     Admin_L_SDate.place(relx = 0.670, rely=0.830)
    #     Admin_E_SDate=DateEntry(Can9, background= "black", foreground= "white",bd=2,font=('Calibri',11),date_pattern='dd-MM-yyyy',maxdate=date.today())
    #     Admin_E_SDate.place(relx = 0.670, rely=0.870,  width=95)

    #     Admin_L_EDate=Label(Can9,text="End Date",fg="#515056",bg="white",bd=0, font=("Calibri", 9, "bold"))
    #     Admin_L_EDate.place(relx = 0.770, rely=0.830)
    #     Admin_E_EDate=DateEntry(Can9, background= "black", foreground= "white",bd=2,font=('Calibri',11),date_pattern='dd-MM-yyyy')
    #     Admin_E_EDate.place(relx = 0.770, rely=0.870, width=95)
        
    #     Raw_Report_Button = Button(Can9, text="Raw Data",bg="#00728F",foreground="white",font=("Calibri", 11,"bold"),command=Raw_Report,cursor="hand2" )
    #     Raw_Report_Button.place(relx = 0.87, rely=0.865, height=26)
    
    Login()
    
    ismaint.mainloop()
CheckWindow = WindowCheck()


def ISMaintenance():
    if "IS_Maintaince_V2.6" in CheckWindow or "IS_Maintaince_V2.7" in CheckWindow or "IS_Maintaince_V2.8" in CheckWindow:
        messagebox.showerror('Already Opened','This application is already opened! Please check.')
    else:
        Main_Function()

def Version_check():
    ProjectID = 'EQIN2021004'
    VersionID = 'V2.8'
    VersionQ = Select_data(dbpath, "Select Status From tblVersions Where ProjectID = '"+ ProjectID +"' And Version = '"+ VersionID +"'; ")        
    if VersionQ[0] == 'Live':        
        ISMaintenance()
    else:
        NewVersion = Select_data(dbpath, "Select Version From tblVersions Where ProjectID = '"+ ProjectID +"' And Status = 'Live'; ")           
        messagebox.showerror('Version Check','You are using an older version of this application, Please close and open Newer Version of ' + NewVersion[0] + '.')        
        quit()
Version_check()







